// Dosya AdÄ±: language.js
const languages = {
    az: {
        languageName: 'ðŸ‡¦ðŸ‡¿ AzÉ™rbaycanca',
        // BaÅŸlÄ±q vÉ™ Qaydalar
        title: 'ðŸ’£ Emoji BombasÄ±',
        rulesTitle: 'ðŸ“‹ Oyun QaydalarÄ± (YENÄ°):',
        rule1: 'BÃ¼tÃ¼n sÉ™viyyÉ™lÉ™r 20 kartdan ibarÉ™tdir.',
        rule2: 'Level 1: HÉ™r oyunÃ§unun 3 bombasÄ± (3 canÄ±) var.',
        rule3: 'Level 2+: HÉ™r oyunÃ§unun 4 bombasÄ± (4 canÄ±) var.',
        rule4: 'BÃ¼tÃ¼n tÉ™hlÃ¼kÉ™siz kartlar aÃ§Ä±ldÄ±qda nÃ¶vbÉ™ti sÉ™viyyÉ™yÉ™ keÃ§irsiniz.',
        // Lobi
        enterName: 'Ä°stifadÉ™Ã§i AdÄ±nÄ±zÄ± Daxil Edin',
        roomCode: 'Otaq Kodu (BoÅŸ buraxÄ±n=Yeni Otaq)',
        joinGame: 'âž• Otaq Qur / Odaya BaÄŸlan',
        // GÃ¶zlÉ™mÉ™
        creatingRoom: 'Otaq Qurulur...',
        roomCreated: 'OtaÄŸÄ±nÄ±z Quruldu!',
        roomCodeTitle: 'Otaq Kodunuz:',
        copyCode: 'Kopyala',
        waitingForPlayer: 'RÉ™qib gÃ¶zlÉ™nilir...',
        pleaseWait: 'ZÉ™hmÉ™t olmasa gÃ¶zlÉ™yin...',
        joiningRoom: 'OtaÄŸa QoÅŸulma:',
        joining: 'QoÅŸulunur...',
        cancel: 'LÉ™ÄŸv Et',
        // Oyun EkranÄ±
        you: 'SÆN',
        levelTitle: 'SÆVÄ°YYÆ',
        waiting: 'RÉ™qib gÃ¶zlÉ™nilir...',
        roleHost: 'Rol: HOST',
        roleGuest: 'Rol: QONAQ',
        yourTurn: 'âœ… SÆNÄ°N NÃ–VBÆN!',
        opponentTurn: 'â³ RÆQÄ°BÄ°N NÃ–VBÆSÄ°',
        exitGame: 'ðŸšª Oyundan Ã‡Ä±x',
        // Chat
        typeMessage: 'Mesaj yazÄ±n...',
        send: 'GÃ¶ndÉ™r',
        // XÉ™bÉ™rdarlÄ±qlar vÉ™ Mesajlar
        connected: 'ServerÉ™ qoÅŸuldu.',
        disconnected: 'BaÄŸlantÄ± kÉ™sildi. YenidÉ™n qoÅŸulunur...',
        errorConnect: 'XÆTA: ServerÉ™ daxil olmaq mÃ¼mkÃ¼n deyil.',
        errorUsername: 'ZÉ™hmÉ™t olmasa etibarlÄ± bir istifadÉ™Ã§i adÄ± daxil edin.',
        copied: 'Otaq Kodu KopyalandÄ±!',
        copyFailed: 'Kopyalama uÄŸursuz oldu.',
        bombExploded: 'BOOM! Bombaya basdÄ±nÄ±z!',
        gameOver: 'Oyun Bitdi!',
        youWon: 'ðŸŽ‰ QAZANDIN!',
        youLost: 'ðŸ˜” MÆÄžLUB OLDUN.',
        draw: 'ðŸ¤ BÆRABÆRÆ!',
        levelComplete: 'SÉ™viyyÉ™ {level} tamamlandÄ±! NÃ¶vbÉ™ti sÉ™viyyÉ™...',
        levelStarting: 'SÉ™viyyÉ™ {level} baÅŸlayÄ±r ({lives} can).',
        cardOpened: 'Bu kart artÄ±q aÃ§Ä±lÄ±b.',
    },
    tr: {
        languageName: 'ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e',
        // BaÅŸlÄ±q ve Kurallar
        title: 'ðŸ’£ Emoji BombasÄ±',
        rulesTitle: 'ðŸ“‹ Oyun KurallarÄ± (YENÄ°):',
        rule1: 'TÃ¼m seviyeler 20 karttan oluÅŸur.',
        rule2: 'Level 1: Her oyuncunun 3 bombasÄ± (3 canÄ±) var.',
        rule3: 'Level 2+: Her oyuncunun 4 bombasÄ± (4 canÄ±) var.',
        rule4: 'TÃ¼m gÃ¼venli kartlar aÃ§Ä±ldÄ±ÄŸÄ±nda sonraki seviyeye geÃ§ilir.',
        // Lobi
        enterName: 'KullanÄ±cÄ± AdÄ±nÄ±zÄ± Girin',
        roomCode: 'Oda Kodu (BoÅŸ BÄ±rakÄ±n=Yeni Oda)',
        joinGame: 'âž• Oda Kur / Odaya KatÄ±l',
        // Bekleme
        creatingRoom: 'Oda Kuruluyor...',
        roomCreated: 'OdanÄ±z Kuruldu!',
        roomCodeTitle: 'Oda Kodunuz:',
        copyCode: 'Kopyala',
        waitingForPlayer: 'Rakip bekleniyor...',
        pleaseWait: 'LÃ¼tfen bekleyin...',
        joiningRoom: 'Odaya KatÄ±lma:',
        joining: 'KatÄ±lÄ±nÄ±lÄ±yor...',
        cancel: 'Ä°ptal Et',
        // Oyun EkranÄ±
        you: 'SEN',
        levelTitle: 'SEVÄ°YE',
        waiting: 'Rakip bekleniyor...',
        roleHost: 'Rol: EV SAHÄ°BÄ°',
        roleGuest: 'Rol: MÄ°SAFÄ°R',
        yourTurn: 'âœ… SIRA SENDE!',
        opponentTurn: 'â³ RAKÄ°BÄ°N SIRASI',
        exitGame: 'ðŸšª Oyundan Ã‡Ä±k',
        // Chat
        typeMessage: 'Mesaj yazÄ±n...',
        send: 'GÃ¶nder',
        // UyarÄ±lar ve Mesajlar
        connected: 'Sunucuya baÄŸlandÄ±.',
        disconnected: 'BaÄŸlantÄ± kesildi. Yeniden baÄŸlanÄ±lÄ±yor...',
        errorConnect: 'HATA: Sunucuya eriÅŸilemiyor.',
        errorUsername: 'LÃ¼tfen geÃ§erli bir kullanÄ±cÄ± adÄ± girin.',
        copied: 'Oda Kodu KopyalandÄ±!',
        copyFailed: 'Kopyalama baÅŸarÄ±sÄ±z.',
        bombExploded: 'BOOM! Bombaya bastÄ±nÄ±z!',
        gameOver: 'Oyun Bitti!',
        youWon: 'ðŸŽ‰ KAZANDIN!',
        youLost: 'ðŸ˜” KAYBETTÄ°N.',
        draw: 'ðŸ¤ BERABERE!',
        levelComplete: 'Seviye {level} tamamlandÄ±! Sonraki seviye...',
        levelStarting: 'Seviye {level} baÅŸlÄ±yor ({lives} can).',
        cardOpened: 'Bu kart zaten aÃ§Ä±k.',
    },
    en: {
        languageName: 'ðŸ‡¬ðŸ‡§ English',
        // Title and Rules
        title: 'ðŸ’£ Emoji Bomb',
        rulesTitle: 'ðŸ“‹ Game Rules (NEW):',
        rule1: 'All levels consist of 20 cards.',
        rule2: 'Level 1: Each player has 3 bombs (3 lives).',
        rule3: 'Level 2+: Each player has 4 bombs (4 lives).',
        rule4: 'When all safe cards are opened, you advance to the next level.',
        // Lobby
        enterName: 'Enter Your Username',
        roomCode: 'Room Code (Leave Blank=New Room)',
        joinGame: 'âž• Create / Join Room',
        // Waiting
        creatingRoom: 'Creating Room...',
        roomCreated: 'Your Room is Ready!',
        roomCodeTitle: 'Your Room Code:',
        copyCode: 'Copy',
        waitingForPlayer: 'Waiting for opponent...',
        pleaseWait: 'Please wait...',
        joiningRoom: 'Joining Room:',
        joining: 'Joining...',
        cancel: 'Cancel',
        // Game Screen
        you: 'YOU',
        levelTitle: 'LEVEL',
        waiting: 'Waiting for opponent...',
        roleHost: 'Role: HOST',
        roleGuest: 'Role: GUEST',
        yourTurn: 'âœ… YOUR TURN!',
        opponentTurn: 'â³ OPPONENT\'S TURN',
        exitGame: 'ðŸšª Exit Game',
        // Chat
        typeMessage: 'Type a message...',
        send: 'Send',
        // Alerts and Messages
        connected: 'Connected to server.',
        disconnected: 'Disconnected. Reconnecting...',
        errorConnect: 'ERROR: Cannot connect to server.',
        errorUsername: 'Please enter a valid username.',
        copied: 'Room Code Copied!',
        copyFailed: 'Copy failed.',
        bombExploded: 'BOOM! You hit a bomb!',
        gameOver: 'Game Over!',
        youWon: 'ðŸŽ‰ YOU WON!',
        youLost: 'ðŸ˜” YOU LOST.',
        draw: 'ðŸ¤ IT\'S A DRAW!',
        levelComplete: 'Level {level} complete! Next level...',
        levelStarting: 'Level {level} starting ({lives} lives).',
        cardOpened: 'This card is already open.',
    }
};

// --- Dil Meneceri (DÉ™yiÅŸmÉ™yib) ---

// Get a translated string
function t(key, params = {}) {
    let lang = window.languageManager.currentLanguage;
    if (!languages[lang] || !languages[lang][key]) {
        // Fallback to English if key not found
        lang = 'en';
    }
    let str = languages[lang][key] || key;
    
    Object.keys(params).forEach(param => {
        str = str.replace(`{${param}}`, params[param]);
    });
    return str;
}

function detectLanguage() {
    const savedLang = localStorage.getItem('preferredLanguage');
    if (savedLang && languages[savedLang]) return savedLang;

    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get('lang');
    if (langParam && languages[langParam]) return langParam;

    const browserLang = navigator.language || navigator.userLanguage;
    if (browserLang) {
        if (browserLang.startsWith('tr')) return 'tr';
        if (browserLang.startsWith('en')) return 'en';
    }
    return 'az'; // Default
}

function setLanguage(lang) {
    if (languages[lang]) {
        window.languageManager.currentLanguage = lang;
        localStorage.setItem('preferredLanguage', lang);
        updateUI();
    }
}

function updateUI() {
    const lang = window.languageManager.currentLanguage;
    
    // Update language button
    const langButtonFlag = document.getElementById('current-language-flag');
    if (langButtonFlag) {
        langButtonFlag.textContent = languages[lang].languageName.split(' ')[0];
    }
    
    // Update all elements with data-lang-key
    document.querySelectorAll('[data-lang-key]').forEach(el => {
        const key = el.getAttribute('data-lang-key');
        const translation = t(key);
        
        // Check if element is an input placeholder
        if (el.tagName === 'INPUT' && el.hasAttribute('placeholder')) {
            el.placeholder = translation;
        } else {
            el.textContent = translation;
        }
    });
}

function toggleLanguageSelector() {
    const selector = document.getElementById('language-selector');
    if (selector) {
        selector.style.display = selector.style.display === 'block' ? 'none' : 'block';
    }
}

// Close language selector when clicking outside
document.addEventListener('click', (e) => {
    const selector = document.getElementById('language-selector');
    const button = document.getElementById('language-button');
    if (selector && button && !selector.contains(e.target) && !button.contains(e.target)) {
        selector.style.display = 'none';
    }
});

// Initialize
function initLanguage() {
    window.languageManager.currentLanguage = detectLanguage();
    updateUI();
}

// Export functions to global scope
window.languageManager = {
    t,
    setLanguage,
    currentLanguage: detectLanguage(),
    initLanguage,
    toggleLanguageSelector,
    updateUI
};
