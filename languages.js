// Dosya AdÄ±: language.js
// Language strings for the game
const languages = {
    az: {
        languageName: 'ðŸ‡¦ðŸ‡¿ AzÉ™rbaycanca',
        // Menu
        gameTitle: '2 OYUN 1 UCUZ',
        selectGame: 'Oyun SeÃ§in',
        memoryGame: 'ðŸ’£ BOMBA KARTLARI (HafÄ±za)',
        pongGame: 'ðŸ“ PÄ°NG PONG (SÃ¼rÉ™tli Ã‡ubuÄŸ)',
        // Lobby
        enterName: 'Ä°stifadÉ™Ã§i AdÄ±nÄ±zÄ± Daxil Edin',
        startGame: 'âœ… Otaq Qur',
        joinGame: 'âž• OtaÄŸa BaÄŸlan',
        roomCode: 'Otaq Kodu (BoÅŸ buraxÄ±n=Yeni Otaq)',
        // Game (Memory)
        yourTurn: 'âœ… SÄ°ZÄ°N NÃ–VBÆNÄ°Z!',
        opponentTurn: 'â³ RÉ™qibin nÃ¶vbÉ™si',
        gameStarting: 'ðŸŽ® Oyun baÅŸlayÄ±r!',
        selectCards: 'ðŸ“Œ Kart seÃ§in',
        gameOver: 'ðŸŽ® Oyun bitdi!',
        youWon: 'ðŸŽ‰ QAZANDIN!',
        youLost: 'ðŸ˜” MÉ™ÄŸlub oldun',
        draw: 'ðŸ¤ BÉ™rabÉ™rÉ™',
        nextLevel: 'NÃ¶vbÉ™ti sÉ™viyyÉ™',
        // Pong 
        pongGameStatus: 'RÉ™qib: {name}', 
        // Chat
        send: 'GÃ¶ndÉ™r',
        typeMessage: 'Mesaj yazÄ±n...',
        // Messages
        playerLeft: 'Oyuncu ayrÄ±ldÄ±. MenÃ¼ye dÃ¶nÃ¼lÃ¼r...',
        waitingForPlayer: 'OyunÃ§u gÃ¶zlÉ™nilir...',
        bombExploded: 'BOMBA! PartladÄ±n!',
        levelStarting: 'SÉ™viyyÉ™ {level} baÅŸlayÄ±r, {lives} can ilÉ™...',
        // UI
        lives: '{lives}',
        level: 'SÉ™viyyÉ™: {level}',
        opponent: 'RÉ™qib: {name}',
        roleHost: 'ðŸŽ® Rol: HOST (SÉ™n baÅŸla)',
        roleGuest: 'ðŸŽ® Rol: QONAQ (RÉ™qib baÅŸlayÄ±r)'
    },
    tr: {
        languageName: 'ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e',
        // Menu
        gameTitle: '2 OYUN 1 FÄ°YATINA',
        selectGame: 'Oyun SeÃ§in',
        memoryGame: 'ðŸ’£ BOMBA KARTLARI (HafÄ±za)',
        pongGame: 'ðŸ“ PÄ°NG PONG (HÄ±zlÄ± Raket)',
        // Lobby
        enterName: 'KullanÄ±cÄ± AdÄ±nÄ±zÄ± Girin',
        startGame: 'âœ… Oda Kur',
        joinGame: 'âž• Odaya BaÄŸlan',
        roomCode: 'Oda Kodu (BoÅŸ BÄ±rakÄ±n=Yeni Oda)',
        // Game (Memory)
        yourTurn: 'âœ… SIRADA SÄ°Z!',
        opponentTurn: 'â³ RAKÄ°BÄ°N SIRASI',
        gameStarting: 'ðŸŽ® Oyun BaÅŸlÄ±yor!',
        selectCards: 'ðŸ“Œ Kart seÃ§in',
        gameOver: 'ðŸŽ® Oyun Bitti!',
        youWon: 'ðŸŽ‰ KAZANDIN!',
        youLost: 'ðŸ˜” KAYBETTÄ°N',
        draw: 'ðŸ¤ BERABERE',
        nextLevel: 'Sonraki Seviye',
        // Pong
        pongGameStatus: 'Rakip: {name}', 
        // Chat
        send: 'GÃ¶nder',
        typeMessage: 'Mesaj yazÄ±n...',
        // Messages
        playerLeft: 'Oyuncu ayrÄ±ldÄ±. MenÃ¼ye dÃ¶nÃ¼lÃ¼yor...',
        waitingForPlayer: 'Oyuncu bekleniyor...',
        bombExploded: 'BOMBA! PatladÄ±n!',
        levelStarting: 'Seviye {level} baÅŸlÄ±yor, {lives} can ile...',
        // UI
        lives: '{lives}',
        level: 'Seviye: {level}',
        opponent: 'Rakip: {name}',
        roleHost: 'ðŸŽ® Rol: EV SAHÄ°BÄ° (Sen baÅŸla)',
        roleGuest: 'ðŸŽ® Rol: MÄ°SAFÄ°R (Rakip baÅŸlar)'
    },
    en: {
        languageName: 'ðŸ‡¬ðŸ‡§ English',
        // Menu
        gameTitle: '2 GAMES FOR 1',
        selectGame: 'Select Game',
        memoryGame: 'ðŸ’£ BOMB CARDS (Memory)',
        pongGame: 'ðŸ“ PING PONG (Fast Paddle)',
        // Lobby
        enterName: 'Enter Your Username',
        startGame: 'âœ… Create Room',
        joinGame: 'âž• Join Room',
        roomCode: 'Room Code (Leave Blank=New Room)',
        // Game (Memory)
        yourTurn: 'âœ… YOUR TURN!',
        opponentTurn: 'â³ OPPONENT\'S TURN',
        gameStarting: 'ðŸŽ® Game Starting!',
        selectCards: 'ðŸ“Œ Select cards',
        gameOver: 'ðŸŽ® Game Over!',
        youWon: 'ðŸŽ‰ YOU WON!',
        youLost: 'ðŸ˜” YOU LOST',
        draw: 'ðŸ¤ DRAW',
        nextLevel: 'Next Level',
        // Pong
        pongGameStatus: 'Opponent: {name}', 
        // Chat
        send: 'Send',
        typeMessage: 'Type a message...',
        // Messages
        playerLeft: 'Player left. Returning to menu...',
        waitingForPlayer: 'Waiting for player...',
        bombExploded: 'BOOM! You hit a bomb!',
        levelStarting: 'Level {level} starting with {lives} lives...',
        // UI
        lives: '{lives}',
        level: 'Level: {level}',
        opponent: 'Opponent: {name}',
        roleHost: 'ðŸŽ® Role: HOST (You start)',
        roleGuest: 'ðŸŽ® Role: GUEST (Opponent starts)'
    }
};

// Detect user's language based on IP or browser settings
function detectLanguage() {
    let lang = 'az';
    const urlParams = new URLSearchParams(window.location.search);
    const langParam = urlParams.get('lang');
    
    if (langParam && languages[langParam]) {
        return langParam;
    }
    
    const browserLang = navigator.language || navigator.userLanguage;
    if (browserLang) {
        if (browserLang.startsWith('tr')) {
            lang = 'tr';
        } else if (browserLang.startsWith('en')) {
            lang = 'en';
        }
    }
    return lang;
}

// Set language and update UI
let currentLanguage = detectLanguage();

function setLanguage(lang) {
    if (languages[lang]) {
        currentLanguage = lang;
        const url = new URL(window.location);
        url.searchParams.set('lang', lang);
        window.history.pushState({}, '', url);
        localStorage.setItem('preferredLanguage', lang);
        updateUI();
    }
}

// Get a translated string
function t(key, params = {}) {
    let str = languages[currentLanguage][key] || key;
    
    Object.keys(params).forEach(param => {
        str = str.replace(`{${param}}`, params[param]);
    });
    
    return str;
}

// Toggle language selector
function toggleLanguageSelector() {
    const selector = document.getElementById('language-selector');
    if (selector) {
        selector.style.display = selector.style.display === 'block' ? 'none' : 'block';
    }
}

// Close language selector when clicking outside
document.addEventListener('click', (e) => {
    const selector = document.getElementById('language-selector');
    const button = document.getElementById('language-button');
    
    if (selector && button && !selector.contains(e.target) && !button.contains(e.target)) {
        selector.style.display = 'none';
    }
});

// Initialize language from localStorage if available
function initLanguage() {
    const savedLang = localStorage.getItem('preferredLanguage');
    if (savedLang && languages[savedLang]) {
        currentLanguage = savedLang;
    }
    updateUI();
}

// Update all UI elements with translations
function updateUI() {
    // Update language button
    const langButton = document.getElementById('language-button');
    if (langButton) {
        langButton.textContent = languages[currentLanguage].languageName;
    }
    
    // Update data-lang-key elements
    document.querySelectorAll('[data-lang-key]').forEach(el => {
        const key = el.getAttribute('data-lang-key');
        if (languages[currentLanguage][key]) {
            el.textContent = languages[currentLanguage][key];
        }
    });

    // Update lobby text (placeholders)
    const nameInput = document.getElementById('username');
    const roomInput = document.getElementById('roomCodeInput');
    if (nameInput) nameInput.placeholder = t('enterName');
    if (roomInput) roomInput.placeholder = t('roomCode');
    
    // Update chat UI
    const messageInput = document.getElementById('chat-input');
    if (messageInput) messageInput.placeholder = t('typeMessage');
}

// Export functions to global scope
window.languageManager = {
    t,
    setLanguage,
    currentLanguage: () => currentLanguage,
    initLanguage,
    toggleLanguageSelector,
    updateUI
};
