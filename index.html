<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Domino - ELO Sistemi il…ô Dominoes</title>
  <script async src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Inter', 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      overflow-x: hidden;
    }
    .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 20px; }
    
    /* Lobby */
    .lobby { display: none; text-align: center; animation: fadeIn 0.5s; }
    .lobby.active { display: block; }
    .lobby h1 { color: white; font-size: 3em; margin-bottom: 10px; text-shadow: 0 4px 6px rgba(0,0,0,0.3); }
    .lobby p { color: rgba(255,255,255,0.8); margin-bottom: 30px; font-size: 1.1em; }
    
    .status-bar {
      background: rgba(255,255,255,0.1);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .user-info {
      background: rgba(255,255,255,0.15);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }
    
    .user-stats { display: flex; gap: 20px; }
    .stat { text-align: center; }
    .stat-label { font-size: 0.9em; opacity: 0.8; }
    .stat-value { font-size: 1.5em; font-weight: bold; margin-top: 5px; }
    
    .modes { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
    
    .btn { 
      padding: 16px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      min-height: 50px;
    }
    .btn-primary { 
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }
    .btn-primary:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
    }
    .btn-leaderboard {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      color: white;
      margin-top: 20px;
    }
    .btn-leaderboard:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
    }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* Modal */
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
    .modal.active { display: flex; animation: fadeIn 0.3s; }
    .modal-content { 
      background: white; 
      padding: 40px; 
      border-radius: 16px; 
      max-width: 400px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideUp 0.3s;
    }
    .modal h2 { color: #667eea; margin-bottom: 20px; font-size: 1.8em; }
    .input-group { margin-bottom: 20px; }
    .input-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; }
    .input-group input { 
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    .input-group input:focus { outline: none; border-color: #667eea; }
    
    .code-display { 
      background: #f0f0f0; 
      padding: 20px; 
      border-radius: 8px; 
      font-family: 'Roboto Mono', monospace;
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
      margin: 20px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    
    .copy-btn { 
      background: #667eea; 
      color: white; 
      border: none; 
      padding: 10px 16px; 
      border-radius: 6px; 
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }
    .copy-btn:hover { background: #5568d3; }
    
    .btn-secondary { background: white; color: #667eea; box-shadow: 0 4px 15px rgba(255,255,255,0.3); }
    .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255,255,255,0.5); }
    .cancel-btn { background: #ddd; color: #333; margin-top: 10px; width: 100%; }
    
    .button-group { display: flex; gap: 10px; margin-top: 30px; }
    .button-group .btn { flex: 1; }
    
    /* Game */
    .game { display: none; color: white; }
    .game.active { display: block; }
    
    .game-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      margin-bottom: 30px;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .player-info { display: flex; gap: 30px; flex-wrap: wrap; }
    .player { 
      padding: 15px 20px;
      border-radius: 8px;
      background: rgba(255,255,255,0.1);
      min-width: 200px;
      text-align: center;
      transition: all 0.3s;
    }
    .player.active { 
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      font-weight: bold;
      box-shadow: 0 0 20px rgba(245, 87, 108, 0.6);
      transform: scale(1.05);
    }
    
    .player-level {
      font-size: 1.5em;
      margin-top: 5px;
    }
    
    .level-sarƒ± { color: #ffd700; }
    .level-mavi { color: #87ceeb; }
    .level-qƒ±zƒ±l { color: #ff6b6b; animation: pulse 2s infinite; }
    
    .game-board {
      background: rgba(255,255,255,0.05);
      padding: 30px;
      border-radius: 16px;
      border: 2px solid rgba(255,255,255,0.1);
      margin-bottom: 30px;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
    }
    
    .table {
      background: rgba(0,100,0,0.3);
      padding: 20px;
      border-radius: 12px;
      border: 2px dashed rgba(255,255,255,0.3);
      margin: 20px 0;
      min-height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .domino {
      width: 50px;
      height: 100px;
      background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-around;
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      border: 2px solid rgba(255,255,255,0.3);
    }
    
    .domino.playable {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      border: 2px solid #00f2fe;
    }
    
    .domino.playable:hover {
      transform: scale(1.15) translateY(-8px);
      box-shadow: 0 6px 20px rgba(0, 242, 254, 0.8);
    }
    
    .hand {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }
    
    .actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    
    /* Leaderboard */
    .leaderboard { display: none; color: white; }
    .leaderboard.active { display: block; }
    .leaderboard h2 { color: white; margin-bottom: 30px; font-size: 2em; text-align: center; }
    
    .lb-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .lb-card {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
      text-align: center;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }
    
    .lb-rank-1 {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #333;
      padding: 30px;
      font-size: 1.2em;
      animation: bounce 2s infinite;
    }
    
    .lb-rank-2 {
      background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
      color: #333;
      padding: 25px;
      font-size: 1.1em;
    }
    
    .lb-rank-3 {
      background: linear-gradient(135deg, #cd7f32 0%, #e5a76a 100%);
      color: #fff;
      padding: 25px;
      font-size: 1.1em;
    }
    
    .lb-rank {
      font-weight: bold;
      font-size: 2em;
      margin-bottom: 10px;
    }
    
    .lb-name {
      font-size: 1.5em;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .lb-level {
      font-size: 2em;
      margin: 10px 0;
    }
    
    .lb-elo {
      font-size: 1.3em;
      font-weight: bold;
      margin-top: 10px;
    }
    
    .lb-stats {
      font-size: 0.9em;
      opacity: 0.8;
      margin-top: 10px;
    }
    
    .lb-current {
      background: rgba(100,200,255,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-top: 30px;
      border: 2px solid rgba(100,200,255,0.4);
      text-align: center;
    }
    
    .back-btn { background: rgba(255,255,255,0.2); color: white; margin-top: 20px; }
    .back-btn:hover { background: rgba(255,255,255,0.3); }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    
    .searching { animation: pulse 1.5s infinite; }
    
    .tip {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 0.95em;
      backdrop-filter: blur(10px);
    }
    
    .info-message {
      background: rgba(255,255,255,0.15);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Lobby -->
    <div class="lobby active" id="lobby">
      <h1>üéØ Domino</h1>
      <p>ELO sistemi il…ô √ßoxoyunculu dominoes oyunu</p>
      
      <div class="status-bar" id="statusBar">Sunucuya baƒülanƒ±lƒ±yor...</div>
      
      <div class="user-info" id="userInfo" style="display: none;">
        <div>
          <strong id="userName">Oyuncu</strong>
        </div>
        <div class="user-stats">
          <div class="stat">
            <div class="stat-label">S…ôviyy…ô</div>
            <div class="stat-value" id="userLevel">1</div>
          </div>
          <div class="stat">
            <div class="stat-label">ELO</div>
            <div class="stat-value" id="userElo">1000</div>
          </div>
          <div class="stat">
            <div class="stat-label">Qalibiyy…ôtl…ôr</div>
            <div class="stat-value" id="userWins">0</div>
          </div>
        </div>
      </div>
      
      <div class="tip">
        üí° <strong>Dereceli Oynama Haqqƒ±nda:</strong><br>
        Dereceli oyunlarda h…ôr q…ôl…ôb…ô √º√ß√ºn 12-20 ELO puan qazanacaqsƒ±nƒ±z. 
        100 puan = 1 s…ôviyy…ô artƒ±rma. Maks s…ôviyy…ô 10-dur.
        Oyunun ortasƒ±nda √ßƒ±xsanƒ±z, 10 puan itir…ôc…ôksiniz.
      </div>
      
      <div class="modes">
        <button class="btn btn-primary" id="btnRanked">
          ‚≠ê Dereceli Ma√ß<br><small>ELO qazanƒ±n</small>
        </button>
        <button class="btn btn-primary" id="btnFriend">
          üë• Dostla Oyna<br><small>Oda yaradƒ±n</small>
        </button>
        <button class="btn btn-primary" id="btnJoin">
          üîó Odaya Qatƒ±lƒ±n<br><small>Kod daxil edin</small>
        </button>
      </div>
      
      <button class="btn btn-leaderboard" id="btnLeaderboard">üìä Liderlik C…ôdv…ôli</button>
      <button class="btn btn-primary" id="btnLogin" style="margin-top: 20px;">üîê Telegram il…ô Daxil Olun</button>
    </div>

    <!-- Create Room Modal -->
    <div class="modal" id="createRoomModal">
      <div class="modal-content">
        <h2>Oda Yaradƒ±n</h2>
        <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="btnCreateRoom">Oda Yaradƒ±n</button>
        <button class="btn cancel-btn" id="btnCloseCreate">L…ôƒüv Et</button>
      </div>
    </div>

    <!-- Room Code Modal -->
    <div class="modal" id="roomCodeModal">
      <div class="modal-content">
        <h2>Oda Kodu</h2>
        <p style="color: #999; margin-bottom: 20px;">Kodu dostunuza g√∂nd…ôrin</p>
        <div class="code-display">
          <span id="roomCode">----</span>
          <button class="copy-btn" id="btnCopyCode">Kopyala</button>
        </div>
        <p style="color: #999; text-align: center; margin-top: 20px;">G√∂zl…ôyin... <span class="searching">‚óè</span></p>
        <button class="btn cancel-btn" id="btnCloseRoom">L…ôƒüv Et</button>
      </div>
    </div>

    <!-- Join Room Modal -->
    <div class="modal" id="joinRoomModal">
      <div class="modal-content">
        <h2>Odaya Qatƒ±lƒ±n</h2>
        <div class="input-group">
          <label>Oda Kodu (4 R…ôq…ôm)</label>
          <input type="text" id="roomCode2" placeholder="0000" maxlength="4">
        </div>
        <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="btnJoinRoomConfirm">Qatƒ±lƒ±n</button>
        <button class="btn cancel-btn" id="btnCloseJoin">L…ôƒüv Et</button>
      </div>
    </div>

    <!-- Game -->
    <div class="game" id="game">
      <div class="game-header">
        <div class="player-info">
          <div class="player" id="player0">
            <div>Oyuncu 1</div>
            <div class="player-level level-sarƒ±" id="player0Level">‚≠ê S…ôv: 1</div>
            <div style="font-size: 0.9em; margin-top: 5px;">Ta≈ü: <span id="player0Hand">7</span></div>
          </div>
          <div class="player" id="player1">
            <div>Oyuncu 2</div>
            <div class="player-level level-sarƒ±" id="player1Level">‚≠ê S…ôv: 1</div>
            <div style="font-size: 0.9em; margin-top: 5px;">Ta≈ü: <span id="player1Hand">7</span></div>
          </div>
        </div>
      </div>

      <div class="game-board">
        <h3>Masa</h3>
        <div class="table" id="table"></div>
        <h3>Sizin Ta≈ülarƒ±nƒ±z</h3>
        <div class="hand" id="hand"></div>
      </div>

      <div class="actions">
        <button class="btn btn-primary" id="btnPass">Ke√ß (Pass)</button>
      </div>
      
      <button class="btn back-btn" id="btnBackToLobby" style="width: 100%; margin-top: 20px;">Lobby'ye D√∂n</button>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard" id="leaderboard">
      <h2>üìä Liderlik C…ôdv…ôli (Top 10)</h2>
      
      <div class="lb-container" id="lbContainer"></div>
      
      <div class="lb-current" id="lbCurrent" style="display: none;">
        <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 10px;">Sizin M√∂vqeyiniz</div>
        <div id="myRankDisplay"></div>
      </div>
      
      <button class="btn back-btn" id="btnBackLb" style="width: 100%;">Lobby'ye D√∂n</button>
    </div>
  </div>

  <script>
    let ws = null;
    let currentUser = null;
    let myIndex = null;
    let gameState = null;

    function connectWS() {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
      ws = new WebSocket(`${protocol}//${window.location.hostname}:${window.location.port}`);
      ws.onopen = () => {
        document.getElementById('statusBar').textContent = '‚úÖ Sunucuya baƒülandƒ±';
        document.getElementById('statusBar').style.borderColor = 'rgba(0, 255, 0, 0.4)';
      };
      ws.onmessage = e => handleMessage(JSON.parse(e.data));
      ws.onerror = () => {
        document.getElementById('statusBar').textContent = '‚ùå Sunucu x…ôtasƒ±';
        document.getElementById('statusBar').style.borderColor = 'rgba(255, 0, 0, 0.4)';
      };
      ws.onclose = () => {
        document.getElementById('statusBar').textContent = '‚è≥ Baƒülantƒ± k…ôsildi - 3s sonra yenid…ôn...';
        setTimeout(connectWS, 3000);
      };
    }

    function handleMessage(msg) {
      if (msg.type === 'auth_ok') {
        currentUser = msg.user;
        document.getElementById('userInfo').style.display = 'flex';
        document.getElementById('btnLogin').style.display = 'none';
        updateUserUI();
      } else if (msg.type === 'game_start') {
        gameState = msg;
        myIndex = msg.players.findIndex(p => p.id === currentUser.telegramId.toString());
        document.getElementById('lobby').classList.remove('active');
        document.getElementById('game').classList.add('active');
        updateGameUI();
      } else if (msg.type === 'move_played') {
        updateGameUI(msg);
      } else if (msg.type === 'game_end') {
        alert(`üéâ ${msg.winnerName} qalibdir! ELO: ${msg.eloChange > 0 ? '+' : ''}${msg.eloChange}`);
        document.getElementById('game').classList.remove('active');
        document.getElementById('lobby').classList.add('active');
        if (msg.winner === currentUser.telegramId.toString()) {
          currentUser.elo += msg.eloChange;
          currentUser.wins++;
          updateUserUI();
        }
      } else if (msg.type === 'leaderboard') {
        displayLeaderboard(msg.data);
      } else if (msg.type === 'my_rank') {
        document.getElementById('myRankDisplay').innerHTML = `
          <strong>#${msg.rank}</strong> - Siz
        `;
      } else if (msg.type === 'status') {
        document.getElementById('statusBar').textContent = msg.message;
      } else if (msg.type === 'error') {
        alert('‚ùå ' + msg.message);
      } else if (msg.type === 'room_created') {
        document.getElementById('roomCode').textContent = msg.code;
      }
    }

    function updateUserUI() {
      if (!currentUser) return;
      const level = Math.min(Math.floor(currentUser.elo / 100), 10);
      document.getElementById('userName').textContent = currentUser.firstName;
      document.getElementById('userLevel').textContent = level;
      document.getElementById('userElo').textContent = currentUser.elo;
      document.getElementById('userWins').textContent = currentUser.wins;
    }

    function updateGameUI(msg = gameState) {
      if (!msg) return;
      const players = msg.players || gameState.players;
      const turn = msg.currentTurn !== undefined ? msg.currentTurn : gameState.currentTurn;
      const hand = msg.myHand || gameState.myHand;
      const table = msg.table || gameState.table;

      for (let i = 0; i < 2; i++) {
        const playerEl = document.getElementById(`player${i}`);
        const level = players[i].level || 1;
        const levelClass = level <= 3 ? 'level-sarƒ±' : level <= 6 ? 'level-mavi' : 'level-qƒ±zƒ±l';
        playerEl.innerHTML = `
          <div>${players[i].name}</div>
          <div class="player-level ${levelClass}">${players[i].levelIcon || '‚≠ê'} S…ôv: ${level}</div>
          <div style="font-size: 0.9em; margin-top: 5px;">Ta≈ü: <span id="player${i}Hand">${msg.playerHands ? msg.playerHands[i] : 7}</span></div>
        `;
        if (turn === i) playerEl.classList.add('active');
        else playerEl.classList.remove('active');
      }

      document.getElementById('table').innerHTML = table.map(d => `
        <div class="domino">
          <span>${d.left}</span>
          <span>|</span>
          <span>${d.right}</span>
        </div>
      `).join('');

      document.getElementById('hand').innerHTML = hand.map((d, idx) => `
        <div class="domino playable" onclick="playDomino(${idx})">
          <span>${d.left}</span>
          <span>|</span>
          <span>${d.right}</span>
        </div>
      `).join('');
    }

    function playDomino(idx) {
      if (gameState && gameState.currentTurn === myIndex) {
        ws.send(JSON.stringify({
          type: 'play_domino',
          domino: gameState.myHand[idx],
          atEnd: true
        }));
      }
    }

    function displayLeaderboard(data) {
      const html = data.slice(0, 3).map((u, i) => {
        const levelClass = u.level <= 3 ? 'level-sarƒ±' : u.level <= 6 ? 'level-mavi' : 'level-qƒ±zƒ±l';
        const rankClass = `lb-rank-${i + 1}`;
        const medals = ['ü•á', 'ü•à', 'ü•â'];
        return `
          <div class="lb-card ${rankClass}">
            <div class="lb-rank">${medals[i]} #${i + 1}</div>
            <div class="lb-name">${u.name}</div>
            <div class="lb-level ${levelClass}">${u.levelIcon} S…ôv: ${u.level}</div>
            <div class="lb-elo">${u.elo} ELO</div>
            <div class="lb-stats">Qalibiyy…ôt: ${u.wins} | M…ôƒülubiyy…ôt: ${u.losses}</div>
          </div>
        `;
      }).join('');

      const otherHtml = data.slice(3).map((u, i) => `
        <div class="lb-card">
          <div>#${i + 4}</div>
          <div style="font-weight: bold; margin: 10px 0;">${u.name}</div>
          <div style="font-size: 1.2em;">${u.levelIcon} S…ôv: ${u.level}</div>
          <div style="margin-top: 10px;">${u.elo} ELO</div>
        </div>
      `).join('');

      document.getElementById('lbContainer').innerHTML = html + otherHtml;
      document.getElementById('leaderboard').classList.add('active');
      document.getElementById('lobby').classList.remove('active');
      ws.send(JSON.stringify({ type: 'get_leaderboard' }));
    }

    // Event listeners
    document.getElementById('btnLogin').onclick = () => {
      window.Telegram.WebApp.ready();
      const user = window.Telegram.WebApp.initData;
      if (user) {
        const userData = JSON.parse(window.Telegram.WebApp.initData.split('user=')[1].split('&')[0]);
        ws.send(JSON.stringify({ type: 'auth', data: userData }));
      } else {
        alert('L√ºtf…ôn Telegram'dan a√ßƒ±n');
      }
    };

    document.getElementById('btnRanked').onclick = () => {
      if (!currentUser) return alert('∆èvv…ôlc…ô Telegram il…ô daxil olun');
      ws.send(JSON.stringify({ type: 'join_matchmaking' }));
    };

    document.getElementById('btnFriend').onclick = () => {
      if (!currentUser) return alert('∆èvv…ôlc…ô Telegram il…ô daxil olun');
      document.getElementById('createRoomModal').classList.add('active');
    };

    document.getElementById('btnCreateRoom').onclick = () => {
      ws.send(JSON.stringify({ type: 'create_room', playerName: currentUser.firstName }));
      document.getElementById('createRoomModal').classList.remove('active');
      document.getElementById('roomCodeModal').classList.add('active');
    };

    document.getElementById('btnJoin').onclick = () => {
      document.getElementById('joinRoomModal').classList.add('active');
    };

    document.getElementById('btnJoinRoomConfirm').onclick = () => {
      const code = document.getElementById('roomCode2').value;
      if (code.length !== 4) return alert('Kod 4 r…ôq…ômlƒ± olmalƒ±dƒ±r');
      ws.send(JSON.stringify({ type: 'join_room', code, playerName: currentUser.firstName }));
      document.getElementById('joinRoomModal').classList.remove('active');
    };

    document.getElementById('btnCopyCode').onclick = () => {
      navigator.clipboard.writeText(document.getElementById('roomCode').textContent);
      alert('‚úÖ Kodu kopyaladƒ±m!');
    };

    document.getElementById('btnLeaderboard').onclick = () => {
      ws.send(JSON.stringify({ type: 'get_leaderboard' }));
    };

    document.getElementById('btnBackToLobby').onclick = () => {
      document.getElementById('game').classList.remove('active');
      document.getElementById('lobby').classList.add('active');
    };

    document.getElementById('btnBackLb').onclick = () => {
      document.getElementById('leaderboard').classList.remove('active');
      document.getElementById('lobby').classList.add('active');
    };

    document.getElementById('btnPass').onclick = () => {
      ws.send(JSON.stringify({ type: 'pass' }));
    };

    ['Close', 'CloseRoom', 'CloseJoin', 'CloseCreate'].forEach(id => {
      const el = document.getElementById('btnClose' + id);
      if (el) el.onclick = () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
    });

    connectWS();
  </script>
</body>
</html>
