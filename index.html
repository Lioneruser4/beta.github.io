<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, height=device-height">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a202c">
    <meta name="format-detection" content="telephone=no">
    <title>üí£ Emoji Kart Bomb 1v1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        // iOS ve Telegram WebView i√ßin touch event desteƒüi
        document.addEventListener('DOMContentLoaded', function() {
            // iOS i√ßin touch event'leri etkinle≈ütir
            const enableTouchEvents = () => {
                document.body.addEventListener('touchstart', function() {}, { passive: true });
                document.body.addEventListener('touchend', function() {}, { passive: true });
            };
            
            // Telegram WebView tespiti
            const isTelegram = window.navigator.userAgent.includes('Telegram');
            if (isTelegram) {
                document.documentElement.classList.add('telegram-webview');
                // Telegram WebView'ƒ± tam ekran yap
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.expand();
                    window.Telegram.WebApp.enableClosingConfirmation();
                }
            }
            
            // iOS tespiti
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (isIOS) {
                document.documentElement.classList.add('ios-device');
                // iOS i√ßin viewport d√ºzeltmesi
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.content = viewport.content + ', maximum-scale=1';
                }
            }

            // Touch event'lerini etkinle≈ütir
            enableTouchEvents();
            
            // Audio context'i ba≈ülat
            initializeAudioContext();
        });

        // Audio context'i ba≈ülatma fonksiyonu
        function initializeAudioContext() {
            // AudioContext'i olu≈ütur
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!window.audioContext) {
                window.audioContext = new AudioContext();
                
                // iOS i√ßin sessiz bir ses √ßalarak audio context'i aktif hale getir
                const silentBuffer = window.audioContext.createBuffer(1, 1, 22050);
                const source = window.audioContext.createBufferSource();
                source.buffer = silentBuffer;
                source.connect(window.audioContext.destination);
                source.start(0);
                
                // Kullanƒ±cƒ± etkile≈üimi i√ßin event listener'lar
                const events = ['touchstart', 'touchend', 'click', 'keydown', 'mousedown'];
                const unlockAudio = () => {
                    if (window.audioContext.state === 'suspended') {
                        window.audioContext.resume();
                    }
                    // Event listener'larƒ± kaldƒ±r
                    events.forEach(event => {
                        document.removeEventListener(event, unlockAudio, true);
                    });
                };
                
                // Event listener'larƒ± ekle
                events.forEach(event => {
                    document.addEventListener(event, unlockAudio, true, { passive: true });
                });
            }
        }
    </script>
    
    <style>
        /* === T√ºm Cihazlar ƒ∞√ßin D√ºzeltmeler === */
        html {
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            height: 100%;
            overflow-x: hidden;
            touch-action: manipulation;
        }
        
        /* iOS i√ßin √∂zel stiller */
        html.ios-device {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        /* Android i√ßin √∂zel stiller */
        html.android-device {
            -webkit-overflow-scrolling: touch;
        }
        
        /* Telegram WebView i√ßin √∂zel stiller */
        html.telegram-webview {
            --tg-viewport-height: 100vh;
            height: 100%;
        }
        
        /* Mobil cihazlar i√ßin genel stiller */
        html.mobile-device {
            --vh: 1vh;
        }
        
        /* Viewport y√ºksekliƒüi sorunlarƒ±nƒ± √ß√∂z */
        @supports (-webkit-touch-callout: none) {
            html {
                height: -webkit-fill-available;
            }
        }
            -webkit-overflow-scrolling: touch;
            height: 100%;
            overflow: hidden;
        }
        
        body {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
            height: 100%;
            position: fixed;
            width: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* iOS ve Telegram i√ßin √∂zel stiller */
        .ios-device .screen,
        .telegram-webview .screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Input alanlarƒ± i√ßin iOS d√ºzeltmesi */
        input, select, textarea {
            font-size: 16px !important;
        }
        
        /* Butonlar i√ßin dokunmatik geri bildirim */
        button, .btn, [role="button"] {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            touch-action: manipulation;
            transition: transform 0.1s ease, opacity 0.1s ease;
        }
        
        button:active, .btn:active, [role="button"]:active,
        button.active, .btn.active, [role="button"].active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        /* iOS'ta :active durumu i√ßin */
        .ios-device button, .ios-device .btn, .ios-device [role="button"] {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
        }
        
        /* Oyun tahtasƒ± i√ßin kaydƒ±rma d√ºzeltmesi */
        .game-board {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
        
        /* === OYUN STƒ∞LLERƒ∞ === */
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --text-color: #2c3e50;
            --bg-color: #ecf0f1;
            --card-bg: white;
            --shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box; /* T√ºm elementler i√ßin box-sizing */
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden; /* Tam ekran i√ßin kaydƒ±rmayƒ± engelle */
            font-family: 'Inter', sans-serif; /* Daha modern bir font */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body { 
            background-color: #1a202c; /* Koyu arka plan */
            color: #e2e8f0; /* A√ßƒ±k metin rengi */
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: background-color 0.3s; 
        }

        /* Ana Ekran D√ºzeni */
        .screen { 
            width: 100%; 
            height: 100vh;
            max-width: 100%;
            max-height: 100%;
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: flex-start;
            padding: 0.25rem; 
            box-sizing: border-box; 
            text-align: center; 
            background-color: #2d3748;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .screen.active { 
            display: flex; 
        }
        
        /* Language Selector */
        .language-selector {
            position: fixed;
            top: env(safe-area-inset-top, 15px); /* G√ºvenli alanlarƒ± destekle */
            right: env(safe-area-inset-right, 15px);
            z-index: 100;
        }
        .language-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #63b3ed;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #e2e8f0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 0.2s;
            backdrop-filter: blur(5px);
            padding: 0;
        }
        .language-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .language-options {
            display: none;
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background: #2d3748;
            border: 1px solid #4a5568;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            overflow: hidden;
            z-index: 101;
            min-width: 150px;
            color: #e2e8f0;
        }
        .language-option {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background-color 0.2s;
        }
        .language-option:hover {
            background-color: #4a5568;
        }
        .language-option:hover {
            background: #4a5568;
        }
        
        /* Utility */
        .btn {
            @apply px-8 py-4 rounded-xl font-bold text-xl transition-all duration-300 flex items-center justify-center;
            min-width: 250px;
            margin: 0.5rem 0;
            height: auto;
            min-height: 60px;
        }
        .btn-primary { 
            @apply bg-blue-600 text-white hover:bg-blue-500 active:scale-98; 
            background: linear-gradient(135deg, #4299e1, #63b3ed); /* Gradient */
            border: none;
        }
        .btn-primary:hover {
            box-shadow: 0 8px 20px rgba(66, 153, 225, 0.6);
        }
        .btn:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Global Mesaj */
        #globalMessage.show { 
            display: block; 
            position: fixed; 
            top: env(safe-area-inset-top, 20px); 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 50; 
            animation: fadeInDown 0.3s ease-out; 
            width: 90%;
            max-width: 400px;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translate(-50%, -20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }

        /* --- ANƒ∞MASYONLAR: LOBƒ∞ Gƒ∞Rƒ∞≈ûƒ∞ VE BUTONLAR --- */
        @keyframes screenFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #lobby.active, #waitScreen.active, #gameScreen.active {
            animation: screenFadeIn 0.5s ease-out forwards;
        }

        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animated-lobby-item {
            opacity: 0;
            animation: slideInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        .lobby-title { animation-delay: 0s; }
        .lobby-subtitle { animation-delay: 0.1s; }
        .rules-box { animation-delay: 0.2s; }
        .input-username-container { animation-delay: 0.3s; }
        .input-roomcode-container { animation-delay: 0.4s; }
        #matchBtn { animation-delay: 0.5s; }
        
        .btn { transition: transform 0.2s, box-shadow 0.2s; }
        .btn:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 8px 20px rgba(66, 153, 225, 0.6); 
        }
        .btn:active {
            transform: translateY(0) scale(0.98);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* Bekleme Ekranƒ± (WaitScreen) i√ßin d√∂nme animasyonu */
        .wait-spinner {
            font-size: 4rem; /* B√ºy√ºk spinner */
            color: #63b3ed;
            animation: spin 1.5s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* OYUN TAHTASI VE MOBƒ∞L UYUMLULUK */
        #gameScreen {
            padding-top: env(safe-area-inset-top, 20px);
            padding-bottom: env(safe-area-inset-bottom, 20px);
            justify-content: flex-start; /* ƒ∞√ßeriƒüi √ºste hizala */
        }
        #gameContent {
            flex-grow: 1; /* Board'ƒ±n mevcut alanƒ± doldurmasƒ±nƒ± saƒülar */
            display: flex;
            flex-direction: column;
            justify-content: center; /* ƒ∞√ßindeki √∂ƒüeleri ortala */
            align-items: center;
            max-width: 100%; /* Mobil geni≈ülik */
            width: 100%;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.25rem;
            margin: 0 auto;
            max-width: 100%;
            width: 100%;
            perspective: 1000px;
            padding: 0.25rem;
            box-sizing: border-box;
            flex: 1;
            overflow: hidden;
        }
        .card-container {
            perspective: 1000px; 
            aspect-ratio: 1; 
            width: 100%; /* Esneklik */
        }
        .card {
            aspect-ratio: 1;
            background: #4a5568;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            transform-style: preserve-3d;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            min-width: 0;
            min-height: 0;
        }
        .card.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 12px;
            font-size: 2rem; /* B√ºy√ºk emoji */
            font-weight: bold;
        }
        @media (min-width: 400px) {
            .card-face { font-size: 2.5rem; }
        }
        .card-face.front {
            background: linear-gradient(135deg, #4299e1, #63b3ed); /* Mavi gradient */
            color: white;
            border: 4px solid #364052; /* Koyu kenarlƒ±k */
            transform: rotateY(0deg); 
            z-index: 2;
        }
        .card-face.back {
            background: #e2e8f0; /* A√ßƒ±k arka plan */
            color: #2d3748; /* Koyu metin */
            transform: rotateY(180deg);
            z-index: 1;
        }
        .card.bomb-selected .card-face.front {
            background: linear-gradient(135deg, #f56565, #e53e3e); /* Kƒ±rmƒ±zƒ± gradient */
            animation: pulse-red 0.5s infinite alternate;
        }
        @keyframes pulse-red {
            from { opacity: 1; }
            to { opacity: 0.8; }
        }
        @keyframes vibrate {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            20% { transform: translate(-1px, -2px) rotate(-1deg); }
            40% { transform: translate(-3px, 0px) rotate(1deg); }
            60% { transform: translate(3px, 2px) rotate(0deg); }
            80% { transform: translate(1px, -1px) rotate(-1deg); }
            100% { transform: translate(-1px, 2px) rotate(1deg); }
        }
        .vibrate {
            animation: vibrate 0.1s linear infinite;
        }

        /* Oyun ƒ∞√ßi Durum Ekranlarƒ± */
        #gameScreen h1 {
            color: #f7fafc; /* Beyaz ba≈ülƒ±k */
            margin-bottom: 1rem;
        }
        #gameScreen .status-panel {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 0.5rem;
            padding: 0.5rem;
            margin: 0.25rem 0;
            width: 100%;
            max-width: 100%;
            font-size: 0.9rem;
        }
        #turnStatus {
            font-size: 1.8rem;
            color: #f7fafc; /* Beyaz */
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        #actionMessage {
            color: #a0aec0; /* Gri ton */
            font-size: 1rem;
            margin-top: 0.5rem;
        }
        #roleStatus {
            color: #cbd5e0;
            background-color: #4a5568;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        #gameContent {
            background-color: #2d3748; /* Koyu gri */
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            padding: 1.5rem;
            width: 100%; /* Tam geni≈ülik */
            max-width: 500px; /* Ortalama cihazlarda daha iyi g√∂r√ºn√ºm */
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center; /* ƒ∞√ßeriyi ortala */
        }
        #endGameBtn {
            margin-top: 1.5rem;
            background-color: #e53e3e;
            color: white;
            width: 80%; /* Daha dar */
            max-width: 250px; /* Max geni≈ülik */
        }

        /* Ba≈ülƒ±klar ve Metinler */
        h1, h2 {
            font-family: 'Poppins', sans-serif; /* Modern ba≈ülƒ±k fontu */
            font-weight: 700;
            color: #f7fafc;
        }
        p, label {
            font-family: 'Inter', sans-serif;
            color: #cbd5e0;
        }
        
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@700&family=Chakra+Petch:wght@700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 select-none">
    <div class="language-selector">
        <button id="language-button" class="language-button" onclick="toggleLanguageSelector()">
            <span id="current-language">üá¶üáø</span>
        </button>
        <div id="language-selector" class="language-options">
            <div class="language-option" onclick="setLanguage('az')">üá¶üáø Az…ôrbaycanca</div>
            <div class="language-option" onclick="setLanguage('tr')">üáπüá∑ T√ºrk√ße</div>
            <div class="language-option" onclick="setLanguage('en')">üá¨üáß English</div>
        </div>
    </div>
    
    <div id="globalMessage" class="hidden w-11/12 max-w-md p-4 bg-red-600 text-white rounded-lg shadow-lg">
        <p id="globalMessageText"></p>
    </div>

    <div id="lobby" class="screen active space-y-6">
        <h1 class="text-4xl font-black animated-lobby-item lobby-title mb-1">
            üí£ Emoji Bombasƒ±
        </h1>
        <p class="text-sm text-gray-400 animated-lobby-item lobby-subtitle mb-4">
            1v1 √áox Oyun√ßulu Bomba Oyunu
        </p>
        
        <div class="bg-blue-800 bg-opacity-30 border-l-2 border-blue-500 text-blue-100 p-2 rounded-lg shadow-lg animated-lobby-item rules-box w-full max-w-md">
            <p class="font-bold text-sm mb-1 text-white">üìã Oyun Qaydalarƒ±:</p>
            <ul class="list-disc list-inside text-left text-xs space-y-1">
                <li>Kartlarƒ± a√ßaraq r…ôqibinizin bombalarƒ±ndan qa√ßƒ±n</li>
                <li>H…ôr k…ôsin 3 canƒ± var</li>
                <li>Canƒ± bit…ôn oyunu uduzur</li>
            </ul>
        </div>
        
        <div class="w-full animated-lobby-item input-username-container max-w-md">
            <p class="text-center text-lg font-bold mb-1 text-white">
                üë§ ƒ∞stifad…ô√ßi Adƒ±
            </p>
            <input type="text" id="username" class="w-full p-3 text-lg text-center rounded-lg shadow-lg text-black" placeholder="Adƒ±nƒ±z" maxlength="15" style="color: #000000 !important;">
        </div>
        
        <div class="w-full animated-lobby-item input-roomcode-container max-w-md">
            <p class="text-center text-lg font-bold mb-1 text-white mt-4">
                üö™ Otaq Kodu
            </p>
            <input type="text" id="roomCodeInput" class="w-full p-3 text-lg text-center rounded-lg shadow-lg text-black uppercase" placeholder="Otaq Kodu (Bo≈üsa yeni otaq)" maxlength="6" style="color: #000000 !important;">
        </div>
        
        <div class="flex flex-col space-y-3 w-full max-w-md mx-auto mt-6">
            <button id="createRoomBtn" class="w-full py-4 px-6 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl text-lg shadow-lg transform transition-all duration-200 active:scale-95">
                <i class="fas fa-plus-circle mr-2"></i> Otaq Qur
            </button>
            <button id="joinRoomBtn" class="w-full py-4 px-6 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl text-lg shadow-lg transform transition-all duration-200 active:scale-95">
                <i class="fas fa-sign-in-alt mr-2"></i> Otaƒüa Qo≈üul
            </button>
        </div>
    </div>
    
    <div id="waitScreen" class="screen p-4">
        <div class="flex flex-col items-center justify-center h-full">
            <div class="wait-spinner mb-4">
                <i class="fas fa-spinner fa-spin text-4xl text-blue-400"></i> 
            </div>
            <h2 id="waitTitle" class="text-2xl font-bold mb-6">Otaq Hazƒ±rlanƒ±r...</h2>
            
            <div id="codeArea" class="w-full max-w-md mb-6">
                <p class="text-sm text-gray-300 mb-2">Otaq kodunuzu dostunuzla payla≈üƒ±n:</p>
                <div id="roomCodeDisplay" class="text-3xl font-bold bg-gray-800 p-4 rounded-lg mb-4 text-center tracking-widest"></div>
                <button id="copyCodeBtn" class="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg text-lg">
                    <i class="fas fa-copy mr-2"></i> Kodu Kopyala
                </button>
            </div>
            
            <p id="waitStatus" class="text-lg text-gray-300 mb-6">R…ôqib qo≈üulmasƒ± g√∂zl…ônilir...</p>
            
            <button id="cancelBtn" class="w-full max-w-xs py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg text-lg">
                <i class="fas fa-times-circle mr-2"></i> L…ôƒüv Et / Lobiye Qayƒ±t
            </button>
        </div>
    </div>

    <div id="gameScreen" class="screen">
        <div class="w-full flex justify-between items-center p-1">
            <div class="text-left pl-2">
                <div id="myLives" class="text-xl">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div class="text-xs text-blue-300">SEN</div>
            </div>
            
            <div class="text-center">
                <h1 class="text-xl font-bold m-0 p-0">üí£</h1>
                <div id="levelInfo" class="text-xs">Seviye: 1</div>
            </div>
            
            <div class="text-right pr-2">
                <div id="opponentLives" class="text-xl">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                <div id="opponentName" class="text-xs text-blue-300">Rakip</div>
            </div>
        </div>
        
        <div class="w-full text-center p-1">
            <div id="turnStatus" class="text-sm font-bold text-yellow-400">SIRA SENDE</div>
            <div id="actionMessage" class="text-xs text-gray-300">Bir kart se√ß</div>
        </div>
        <p id="roleStatus" class="text-gray-300 text-xs bg-gray-700 p-2 rounded-lg"></p>

        <div id="gameContent" class="bg-gray-800 rounded-xl w-full space-y-4 p-4 shadow-xl">
            <h3 id="turnStatus" class="text-2xl font-bold text-red-400"></h3>
            
            <div id="gameBoard" class="grid w-full mx-auto">
            </div>
        </div>
        
        <button id="endGameBtn" class="btn bg-red-600 hover:bg-red-500 text-white text-sm py-3">üö™ Oyundan √áƒ±x <i class="fas fa-door-open ml-2"></i></button>
    </div>

    <script src="languages.js"></script>
    
    <script>
        // Butonlara tƒ±klama olaylarƒ±nƒ± ekle
        document.addEventListener('DOMContentLoaded', function() {
            // Oda olu≈ütur butonu
            document.getElementById('createRoomBtn').addEventListener('click', function() {
                console.log('Oda olu≈ütur butonuna tƒ±klandƒ±');
                const username = document.getElementById('username').value.trim();
                if (!username) {
                    alert('L√ºtfen bir kullanƒ±cƒ± adƒ± girin');
                    return;
                }
                connectToServer();
            });

            // Odaya katƒ±l butonu
            document.getElementById('joinRoomBtn').addEventListener('click', function() {
                console.log('Odaya katƒ±l butonuna tƒ±klandƒ±');
                const username = document.getElementById('username').value.trim();
                const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
                
                if (!username) {
                    alert('L√ºtfen bir kullanƒ±cƒ± adƒ± girin');
                    return;
                }
                
                if (!roomCode) {
                    alert('L√ºtfen bir oda kodu girin');
                    return;
                }
                
                connectToServer(roomCode);
            });

            // Kodu kopyala butonu
            document.getElementById('copyCodeBtn').addEventListener('click', function() {
                const roomCode = document.getElementById('roomCodeDisplay').textContent;
                if (roomCode && roomCode !== 'Y√ºkleniyor...') {
                    navigator.clipboard.writeText(roomCode).then(function() {
                        alert('Oda kodu panoya kopyalandƒ±: ' + roomCode);
                    }).catch(function() {
                        // Tarayƒ±cƒ± desteklemiyorsa
                        const tempInput = document.createElement('input');
                        document.body.appendChild(tempInput);
                        tempInput.value = roomCode;
                        tempInput.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempInput);
                        alert('Oda kodu kopyalandƒ±: ' + roomCode);
                    });
                }
            });

            // ƒ∞ptal butonu
            document.getElementById('cancelBtn').addEventListener('click', function() {
                if (socket && socket.connected) {
                    socket.disconnect();
                }
                showScreen('lobby');
            });

            // Oyunu bitir butonu
            document.getElementById('endGameBtn').addEventListener('click', function() {
                if (confirm('Oyundan √ßƒ±kmak istediƒüinize emin misiniz?')) {
                    if (socket && socket.connected) {
                        socket.disconnect();
                    }
                    showScreen('lobby');
                }
            });

            // Kullanƒ±cƒ± adƒ± alanƒ±na enter tu≈üu ile submit √∂zelliƒüi ekle
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const roomCode = document.getElementById('roomCodeInput').value.trim();
                    if (roomCode) {
                        document.getElementById('joinRoomBtn').click();
                    } else {
                        document.getElementById('createRoomBtn').click();
                    }
                }
            });

            // Oda kodu alanƒ±na enter tu≈üu ile submit √∂zelliƒüi ekle
            document.getElementById('roomCodeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('joinRoomBtn').click();
                }
            });
        });
    </script>
    
    <script type="module">
        import { setupSocketHandlers, showScreen, UIElements, showGlobalMessage } from './game.js';
        
        // Global socket deƒüi≈ükeni
        let socket;
        
        // Hata ayƒ±klama i√ßin konsol √ßƒ±ktƒ±larƒ±
        console.log('Script y√ºklendi, socket.io versiyonu:', io?.version);
        
        // Global showScreen fonksiyonu
        window.showScreen = showScreen;
        
        // Platform kontrol√º
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isAndroid = /Android/.test(navigator.userAgent);
        const isTelegram = window.navigator.userAgent.includes('Telegram');
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isMobile = isIOS || isAndroid || /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        console.log('Platform bilgisi:', { isIOS, isAndroid, isTelegram, isSafari, isMobile });
        
        // Platforma √∂zel sƒ±nƒ±flar ekle
        if (isIOS) document.documentElement.classList.add('ios-device');
        if (isAndroid) document.documentElement.classList.add('android-device');
        if (isTelegram) document.documentElement.classList.add('telegram-webview');
        if (isMobile) document.documentElement.classList.add('mobile-device');
        
        // Dil y√∂neticisini ba≈ülat
        document.addEventListener('DOMContentLoaded', () => {
            window.languageManager.initLanguage();
            initializeApp();
        });
        
        window.toggleLanguageSelector = languageManager.toggleLanguageSelector;
        window.setLanguage = languageManager.setLanguage;

        // Sunucu URL'si - WebSocket protokol√º ile ba≈ülamalƒ±
        const LIVE_SERVER_URL = 'wss://beta-github-io.onrender.com';
        let socket;
        let reconnectAttempts = 0;
        const MAX_RECONNECT_ATTEMPTS = 5;
        
        // Socket baƒülantƒ± se√ßenekleri
        const socketOptions = {
            reconnection: true,
            reconnectionAttempts: MAX_RECONNECT_ATTEMPTS,
            reconnectionDelay: 1000,
            reconnectionDelayMax: 5000,
            timeout: 10000,
            transports: isMobile ? ['websocket'] : ['websocket', 'polling'],
            upgrade: !isMobile,
            forceNew: true,
            withCredentials: true,
            secure: true,
            rejectUnauthorized: false,
            extraHeaders: {
                'X-Platform': isIOS ? 'ios' : isAndroid ? 'android' : isTelegram ? 'telegram' : 'web',
                'X-User-Agent': navigator.userAgent
            },
            // iOS ve Android i√ßin √∂zel ayarlar
            ...(isMobile && {
                pingInterval: 25000,
                pingTimeout: 60000,
                autoConnect: true
            })
        };
        
        console.log('Socket baƒülantƒ± ayarlarƒ±:', socketOptions);
        
        // Uygulama ba≈ülangƒ±√ß ayarlarƒ±
        function initializeApp() {
            // iOS ve Android i√ßin viewport ayarlarƒ±
            if (isMobile) {
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover';
                }
                
                // iOS i√ßin input alanlarƒ±nƒ± optimize et
                if (isIOS) {
                    document.querySelectorAll('input, textarea, select').forEach(el => {
                        el.setAttribute('autocorrect', 'off');
                        el.setAttribute('autocapitalize', 'none');
                        el.setAttribute('spellcheck', 'false');
                    });
                }
            }
            
            // Telegram WebView ayarlarƒ±
            if (isTelegram && window.Telegram?.WebApp) {
                try {
                    window.Telegram.WebApp.expand();
                    window.Telegram.WebApp.enableClosingConfirmation();
                    window.Telegram.WebApp.setHeaderColor('#1a202c');
                    window.Telegram.WebApp.setBackgroundColor('#1a202c');
                } catch (e) {
                    console.error('Telegram WebApp API hatasƒ±:', e);
                }
            }
            
            // Dokunmatik etkile≈üimleri iyile≈ütir
            setupTouchInteractions();
        }
        
        // Dokunmatik etkile≈üimleri ayarla
        function setupTouchInteractions() {
            // T√ºm butonlar i√ßin dokunmatik geri bildirim
            document.querySelectorAll('button, .btn, [role="button"]').forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('active');
                }, { passive: true });
                
                button.addEventListener('touchend', function() {
                    this.classList.remove('active');
                }, { passive: true });
                
                button.addEventListener('touchcancel', function() {
                    this.classList.remove('active');
                }, { passive: true });
                
                // iOS'ta :active durumu i√ßin
                button.style.cursor = 'pointer';
            });
            
            // iOS'ta scroll sorunlarƒ±nƒ± √∂nle
            document.body.addEventListener('touchmove', preventDefaultScroll, { passive: false });
            
            // Giri≈ü alanlarƒ± i√ßin optimize et
            document.querySelectorAll('input, textarea').forEach(input => {
                input.addEventListener('focus', handleInputFocus);
                input.addEventListener('blur', handleInputBlur);
            });
        }
        
        // Dokunmatik scroll engelleme
        function preventDefaultScroll(e) {
            // Sadece dokunmatik cihazlarda ve gerekli durumlarda engelle
            if (isMobile && !e.target.closest('.scrollable')) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }
        
        // Giri≈ü alanƒ± odaklandƒ±ƒüƒ±nda
        function handleInputFocus(e) {
            if (isMobile) {
                // iOS'ta klavye a√ßƒ±ldƒ±ƒüƒ±nda sayfayƒ± yukarƒ± kaydƒ±r
                setTimeout(() => {
                    e.target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        }
        
        // Giri≈ü alanƒ± odak dƒ±≈üƒ± olduƒüunda
        function handleInputBlur() {
            if (isMobile) {
                // Klavye kapandƒ±ƒüƒ±nda sayfayƒ± eski haline getir
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }
        
        function validateInput() {
            const username = UIElements.usernameInput.value.trim();
            if (username.length < 2) {
                UIElements.showGlobalMessage('Z…ôhm…ôt olmasa etibarlƒ± bir istifad…ô√ßi adƒ± daxil edin.', true);
                return false;
            }
            return username;
        }

        // Sunucuya baƒülanma fonksiyonu
    async function connectToServer(roomCode = '') {
        const username = document.getElementById('username').value.trim();
        if (!username) {
            showGlobalMessage('L√ºtfen bir kullanƒ±cƒ± adƒ± girin', true);
            return;
        }
        
        console.log('Sunucuya baƒülanƒ±lƒ±yor...', LIVE_SERVER_URL);
        
        // Baƒülantƒ± durumu g√∂ster
        showScreen('wait');
        document.getElementById('waitTitle').textContent = 'Sunucuya baƒülanƒ±lƒ±yor...';
        document.getElementById('waitStatus').textContent = 'L√ºtfen bekleyin...';
        
        try {
            // Socket baƒülantƒ±sƒ±nƒ± olu≈ütur
            socket = io(LIVE_SERVER_URL, socketOptions);
            
            // Baƒülantƒ± ba≈üarƒ±lƒ± olduƒüunda
            socket.on('connect', () => {
                console.log('Sunucuya baƒülandƒ±. Socket ID:', socket.id);
                
                // Odaya katƒ±l veya olu≈ütur
                if (roomCode) {
                    // Odaya katƒ±l
                    socket.emit('joinRoom', { 
                        username: username,
                        roomCode: roomCode 
                    });
                    console.log('Odaya katƒ±lƒ±m isteƒüi g√∂nderildi:', roomCode);
                } else {
                    // Yeni oda olu≈ütur
                    socket.emit('createRoom', { 
                        username: username 
                    });
                    console.log('Yeni oda olu≈üturuluyor...');
                }
            });
            
            // Oda olu≈üturulduƒüunda
            socket.on('roomCreated', (code) => {
                console.log('Oda olu≈üturuldu:', code);
                document.getElementById('roomCodeDisplay').textContent = code;
                document.getElementById('waitTitle').textContent = 'Otaƒüƒ±nƒ±z Kuruldu! üéâ';
                document.getElementById('codeArea').classList.remove('hidden');
                document.getElementById('waitStatus').textContent = 'Oda kodunu dostunuza g√∂nderin ve katƒ±lmasƒ±nƒ± bekleyin.';
            });
            
            // Odaya katƒ±lƒ±m ba≈üarƒ±sƒ±z olduƒüunda
            socket.on('joinFailed', (message) => {
                console.error('Odaya katƒ±lamadƒ±:', message);
                showGlobalMessage(message, true);
                showScreen('lobby');
            });
            
            // Oyun ba≈üladƒ±ƒüƒ±nda
            socket.on('gameStart', (data) => {
                console.log('Oyun ba≈üladƒ±:', data);
                setupSocketHandlers(socket, data.roomCode, data.isHost, data.opponentName);
                showScreen('game');
            });
            
            // Hata durumunda
            socket.on('error', (error) => {
                console.error('Socket hatasƒ±:', error);
                showGlobalMessage('Bir hata olu≈ütu: ' + (error.message || 'Bilinmeyen hata'), true);
            });
            
            // Baƒülantƒ± koptuƒüunda
            socket.on('disconnect', (reason) => {
                console.log('Baƒülantƒ± kesildi:', reason);
                if (reason === 'io server disconnect') {
                    // Sunucu tarafƒ±ndan baƒülantƒ± kesildi
                    showGlobalMessage('Sunucu baƒülantƒ±sƒ± kesildi. Tekrar baƒülanƒ±lƒ±yor...', true);
                    socket.connect();
                }
            });
            
        } catch (error) {
            console.error('Baƒülantƒ± hatasƒ±:', error);
            showGlobalMessage('Baƒülantƒ± hatasƒ± olu≈ütu: ' + (error.message || 'Bilinmeyen hata'), true);
            showScreen('lobby');
            
            // Hata durumunda 3 saniye sonra tekrar dene
            setTimeout(() => {
                console.log('Hata sonrasƒ± tekrar baƒülanƒ±lƒ±yor...');
                connectToServer(roomCode);
            }, 3000);
        }
            try {
                socket = io(LIVE_SERVER_URL, {
                    transports: ['websocket', 'polling'], 
                    reconnectionAttempts: 5, 
                    timeout: 20000 
                });

                socket.on('connect', () => {
                    UIElements.showGlobalMessage('Server…ô qo≈üuldu. E≈ül…ô≈üm…ôy…ô hazƒ±rsƒ±nƒ±z.', false);
                    showScreen('lobby');
                });
                
                socket.on('connect_error', (err) => {
                    console.error('Baƒülantƒ± Hatasƒ±:', err);
                    UIElements.showGlobalMessage('X∆èTA: Server…ô daxil olmaq m√ºmk√ºn deyil.', true);
                    showScreen('lobby');
                });
                
                socket.on('disconnect', () => {
                    UIElements.showGlobalMessage('Baƒülantƒ± k…ôsildi. Yenid…ôn qo≈üulmaƒüa √ßalƒ±≈üƒ±lƒ±r...', true);
                });

                // --- E≈üle≈üme Olaylarƒ± ---
                socket.on('roomCreated', (code) => {
                    document.getElementById('roomCodeDisplay').textContent = code;
                    document.getElementById('waitTitle').textContent = 'Otaƒüƒ±nƒ±z Quruldu! üéâ';
                    document.getElementById('codeArea').classList.remove('hidden');
                    document.getElementById('waitStatus').textContent = 'Otaq kodunu dostunuza g√∂nd…ôrin v…ô qo≈üulmasƒ±nƒ± g√∂zl…ôyin.';
                });
                
                socket.on('joinFailed', (message) => {
                    UIElements.showGlobalMessage(message, true);
                    showScreen('lobby');
                });
                
                socket.on('gameStart', (data) => {
                    console.log('Oyun ba≈üladƒ±:', data);
                    setupSocketHandlers(socket, data.roomCode, data.isHost, data.opponentName);
                    showScreen('game');
                });
                
                // Genel hata y√∂netimi
                socket.on('error', (error) => {
                    console.error('Socket hatasƒ±:', error);
                    showGlobalMessage('Bir hata olu≈ütu: ' + (error.message || 'Bilinmeyen hata'), true);
                });
                
                // Baƒülantƒ± koptuƒüunda
                socket.on('disconnect', (reason) => {
                    console.log('Baƒülantƒ± kesildi:', reason);
                    if (reason === 'io server disconnect') {
                        // Sunucu tarafƒ±ndan baƒülantƒ± kesildi
                        showGlobalMessage('Sunucu baƒülantƒ±sƒ± kesildi. Tekrar baƒülanƒ±lƒ±yor...', true);
                        socket.connect();
                    }
                });
                
            } catch (error) {
                console.error('Baƒülantƒ± hatasƒ±:', error);
                showGlobalMessage('Baƒülantƒ± hatasƒ± olu≈ütu: ' + (error.message || 'Bilinmeyen hata'), true);
                showScreen('lobby');
                
                // Hata durumunda 3 saniye sonra tekrar dene
                setTimeout(() => {
                    console.log('Hata sonrasƒ± tekrar baƒülanƒ±lƒ±yor...');
                    connectToServer();
                }, 3000);
            }            
                        // iOS i√ßin sessiz bir ses √ßal
                        if (audioContext.state === 'suspended') {
                            audioContext.resume();
                        }
                        
<!-- ... -->
                        document.removeEventListener('touchstart', unlockAudio);
                        document.removeEventListener('touchend', unlockAudio);
                        document.removeEventListener('click', unlockAudio);
                    };
                    
                    // Kullanƒ±cƒ± etkile≈üimi i√ßin event listener'lar ekle
                    document.addEventListener('touchstart', unlockAudio, { once: true });
                    document.addEventListener('touchend', unlockAudio, { once: true });
                    document.addEventListener('click', unlockAudio, { once: true });
                    
                    // Telegram WebView i√ßin ekstra kontrol
                    if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.expand();
                        window.Telegram.WebApp.enableClosingConfirmation();
                    }
                }
            };
            
            // Sayfa y√ºklendiƒüinde ses ba≈ülatmayƒ± dene
            initAudioContext();
            
            // Oyun ba≈ülatma i≈ülemi
            connectToServer();
        });
    </script>
    
    <!-- iOS ve Telegram WebView i√ßin ek script -->
    <script>
        // iOS i√ßin viewport ve touch event d√ºzeltmeleri
        document.addEventListener('DOMContentLoaded', function() {
            // iOS'ta scroll sorunlarƒ±nƒ± √∂nleme
            const preventDefaultScroll = function(e) {
                // Sadece div ve button elementlerinde scroll'u engelle
                if (e.target.tagName === 'DIV' || e.target.tagName === 'BUTTON') {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            };
            
            // Touch event'lerini engelleme
            document.body.addEventListener('touchmove', preventDefaultScroll, { passive: false });
            
            // iOS'ta input odaklandƒ±ƒüƒ±nda sayfanƒ±n kaymasƒ±nƒ± engelle
            const inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    window.scrollTo(0, 0);
                    document.body.scrollTop = 0;
                });
            });
            
            // iOS'ta sayfa y√ºklendiƒüinde scroll'u sƒ±fƒ±rla
            window.addEventListener('load', function() {
                setTimeout(function() {
                    window.scrollTo(0, 0);
                }, 0);
                
                // iOS'ta sayfa boyutunu ayarla
                const setViewportHeight = () => {
                    let vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                };
                
                setViewportHeight();
                window.addEventListener('resize', setViewportHeight);
                window.addEventListener('orientationchange', setViewportHeight);
            });
        });
        document.addEventListener('DOMContentLoaded', function() {
            // iOS i√ßin viewport d√ºzeltmesi
            if (/(iPad|iPhone|iPod)/g.test(navigator.userAgent)) {
                const viewport = document.querySelector('meta[name=viewport]');
                if (viewport) {
                    viewport.content = viewport.content + ', maximum-scale=1.0';
                }
                
                // iOS i√ßin touch event'leri
                document.body.style.cursor = 'pointer';
                
                // iOS i√ßin scroll d√ºzeltmesi
                document.body.addEventListener('touchmove', function(e) {
                    if (e.target.tagName === 'DIV' || e.target.tagName === 'BUTTON') {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
            
            // Telegram WebView i√ßin ekstra d√ºzenleme
            if (window.navigator.userAgent.includes('Telegram')) {
                document.documentElement.style.overflow = 'auto';
                document.body.style.overflow = 'auto';
            }
        });
    </script>
    
    <!-- iOS ve Telegram WebView i√ßin ek stil d√ºzeltmeleri -->
    <style>
        /* iOS ve Telegram WebView i√ßin ek stil d√ºzeltmeleri */
        :root {
            --vh: 1vh;
        }
        
        /* iOS input zoom'u engelleme */
        @supports (-webkit-touch-callout: none) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
        
        /* iOS Safari'de butonlarƒ±n mavi rengini kaldƒ±rma */
        input, textarea, button, select, a, div {
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            -webkit-tap-highlight-color: transparent;
        }
        
        /* iOS'ta hƒ±zlƒ± tƒ±klamalarƒ± i≈üleme */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* iOS'ta scroll davranƒ±≈üƒ±nƒ± iyile≈ütirme */
        .screen {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
        }
        
        /* iOS'ta input alanlarƒ± i√ßin d√ºzeltme */
        input, textarea, select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 0;
            -webkit-border-radius: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: text;
            -webkit-overflow-scrolling: touch;
        }
        
        /* iOS'ta input alanlarƒ±nƒ± d√ºzelt */
        .ios-device input, 
        .ios-device textarea, 
        .ios-device select {
            font-size: 16px !important; /* iOS zoom'u √∂nler */
            transform: translateZ(0); /* Donanƒ±m hƒ±zlandƒ±rma */
        }
        
        /* iOS'ta input odaklandƒ±ƒüƒ±nda b√ºy√ºme sorununu √ß√∂z */
        @supports (-webkit-touch-callout: none) {
            input, textarea {
                font-size: 16px !important;
            }
        }
    </style>
</body>
</html>
