<!DOCTYPE html>
<html lang="tr">
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1b4d3e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>3D Online Ranked Domino</title>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Roboto', 'sans-serif'] },
                    colors: {
                        table: {
                            base: '#1b4d3e', // Klasik Ye≈üil Masa
                            dark: '#0f2b23',
                            light: '#2c6b58'
                        },
                        bone: {
                            face: '#fdfdfd',
                            side: '#e2e2e2',
                            shadow: '#00000040'
                        }
                    },
                    boxShadow: {
                        '3d': '0px 4px 0px #c7c7c7, 0px 6px 6px rgba(0,0,0,0.4)', // Ta≈üƒ±n 3D kalƒ±nlƒ±ƒüƒ±
                        '3d-active': '0px 2px 0px #c7c7c7, 0px 3px 3px rgba(0,0,0,0.4)',
                        'inner-pip': 'inset 0 1px 2px rgba(0,0,0,0.6)',
                        'glow': '0 0 15px #fbbf24, 0 0 5px #fbbf24' // ƒ∞pucu parlamasƒ±
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'slide-in': 'slideIn 0.5s cubic-bezier(0.16, 1, 0.3, 1)',
                        'celebrate': 'celebrate 1s ease-out',
                        'glow-pulse': 'glowPulse 2s ease-in-out infinite',
                        'shake': 'shake 0.5s ease-in-out'
                    },
                    keyframes: {
                        slideUp: { '0%': { transform: 'translateY(100%)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } },
                        slideIn: { '0%': { transform: 'scale(0) rotate(180deg)', opacity: '0' }, '100%': { transform: 'scale(1) rotate(0)', opacity: '1' } },
                        celebrate: {
                            '0%': { transform: 'scale(1) rotate(0deg)' },
                            '25%': { transform: 'scale(1.2) rotate(-10deg)' },
                            '50%': { transform: 'scale(1.3) rotate(10deg)' },
                            '75%': { transform: 'scale(1.2) rotate(-5deg)' },
                            '100%': { transform: 'scale(1) rotate(0deg)' }
                        },
                        glowPulse: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(251, 191, 36, 0.8), 0 0 40px rgba(251, 191, 36, 0.4)' },
                            '50%': { boxShadow: '0 0 30px rgba(251, 191, 36, 1), 0 0 60px rgba(251, 191, 36, 0.6)' }
                        },
                        shake: {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-10px)' },
                            '75%': { transform: 'translateX(10px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Ye≈üil √áuha Masa Dokusu */
        body {
            background-color: #1b4d3e;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23153d31' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/svg%3E");
            overflow: hidden;
            touch-action: pan-y pinch-zoom;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            padding-top: 40px; /* Siteyi biraz a≈üaƒüƒ± indir */
            animation: bg-scroll 20s linear infinite;
        }

        @keyframes bg-scroll {
            0% { background-position: 0 0; }
            100% { background-position: 40px 40px; }
        }

        .pip-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 100%;
            height: 100%;
            padding: 2px;
        }

        .pip {
            background-color: #111;
            border-radius: 50%;
            width: 5px;
            height: 5px;
            margin: auto;
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.2);
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Parlaklƒ±k Efekti */
        .valid-zone {
            position: relative;
            animation: pulse-glow 1.5s infinite;
        }

        .valid-zone::before {
            content: '';
            position: absolute;
            inset: -8px;
            background: linear-gradient(45deg, transparent, rgba(251, 191, 36, 0.3), transparent);
            border-radius: 12px;
            animation: rotate 3s linear infinite;
        }

        .valid-zone::after {
            content: '';
            position: absolute;
            inset: -4px;
            background: rgba(251, 191, 36, 0.2);
            border-radius: 10px;
            filter: blur(10px);
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(251, 191, 36, 0.6), 0 0 40px rgba(251, 191, 36, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(251, 191, 36, 0.9), 0 0 60px rgba(251, 191, 36, 0.5);
            }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes progress {
            from { width: 0%; }
            to { width: 100%; }
        }

        .animate-progress {
            animation: progress 4s linear forwards;
        }

        @keyframes slide-right {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slide-left {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .animate-slide-right {
            animation: slide-right 0.5s ease-out forwards;
        }

        .animate-slide-left {
            animation: slide-left 0.5s ease-out forwards;
        }

        @keyframes neon-pulse {
            0%, 100% {
                box-shadow: 0 0 10px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 0, 0, 0.4);
                filter: brightness(1.2);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 0, 0, 1), 0 0 40px rgba(255, 0, 0, 0.6);
                filter: brightness(1.5);
            }
        }

        @keyframes border-flow {
            0% { border-color: #ff0000; }
            33% { border-color: #00ff00; }
            66% { border-color: #0000ff; }
            100% { border-color: #ff0000; }
        }

        .neon-pro {
            animation: neon-pulse 1.5s infinite ease-in-out, border-flow 3s infinite linear;
            background: linear-gradient(135deg, #111 0%, #333 100%);
            border-width: 2px;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
        }

        /* Yeni eklenen stiller */
        .hand-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 4px;
            max-height: 120px;
            overflow-y: auto;
        }

        .hand-container.single-row {
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .opponent-hand {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 10px;
        }

        .opponent-tile {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // Telegram WebApp Initialization
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // API Base URL
        const API_URL = window.location.hostname === 'localhost' ? 'http://localhost:10000' : 'https://beta-github-io.onrender.com';

        // --- Bƒ∞LE≈ûENLER ---

        // 1. Domino Noktalarƒ± (Pips)
        const RenderPips = ({ number }) => {
            const layouts = {
                0: [], 1: [4], 2: [0, 8], 3: [0, 4, 8],
                4: [0, 2, 6, 8], 5: [0, 2, 4, 6, 8], 6: [0, 2, 3, 5, 6, 8]
            };
            const activePips = layouts[number] || [];
            return (
                <div className="pip-grid">
                    {[...Array(9)].map((_, i) => (
                        <div key={i} className="pip" style={{ opacity: activePips.includes(i) ? 1 : 0 }}></div>
                    ))}
                </div>
            );
        };

        // 2. Domino Ta≈üƒ± (3D Tasarƒ±m)
        const DominoTile = ({ values, onClick, disabled, isSelected, vertical = true, scale = 1, isGhost = false, animateIn = false, isOpponent = false }) => {
            const baseClasses = `
                relative flex overflow-hidden bg-bone-face border border-gray-300 rounded-md
                transition-all duration-300 select-none
                ${vertical ? 'flex-col w-[40px] h-[80px]' : 'flex-row w-[80px] h-[40px]'}
                ${isGhost ? 'opacity-0 pointer-events-none' : 'shadow-3d'}
                ${isSelected ? '-translate-y-4 shadow-3d-active ring-2 ring-yellow-500 z-10 animate-celebrate' : ''}
                ${animateIn ? 'animate-slide-in' : ''}
                ${!disabled && !isGhost && !isOpponent ? 'cursor-pointer active:translate-y-1 active:shadow-3d-active hover:brightness-110' : ''}
                ${disabled ? 'brightness-90 cursor-default' : ''}
                ${isOpponent ? 'bg-gradient-to-br from-gray-800 to-gray-900 border-gray-700' : ''}
            `;

            return (
                <div
                    onClick={onClick}
                    className={baseClasses}
                    style={{
                        transform: isSelected ? 'translateY(-15px) scale(1.1)' : `scale(${scale})`,
                        boxShadow: isGhost ? 'none' : '0 2px 4px rgba(0,0,0,0.2)'
                    }}
                >
                    {!isOpponent ? (
                        <>
                            <div className={`flex-1 flex items-center justify-center ${vertical ? 'border-b' : 'border-r'} border-gray-200`}>
                                <RenderPips number={values[0]} />
                            </div>
                            <div className="flex-1 flex items-center justify-center">
                                <RenderPips number={values[1]} />
                            </div>
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full bg-gray-300 border border-gray-400 shadow-inner z-10 opacity-50"></div>
                        </>
                    ) : (
                        <div className="w-full h-full flex items-center justify-center">
                            <div className="w-6 h-6 rounded-full bg-gradient-to-br from-gray-900 to-black border border-gray-700"></div>
                        </div>
                    )}
                </div>
            );
        };

        // 3. Bildirim Toast
        const Toast = ({ message, type }) => {
            const colors = { success: 'bg-green-600', error: 'bg-red-600', info: 'bg-blue-600', warning: 'bg-yellow-600' };
            return (
                <div className={`fixed top-4 left-1/2 -translate-x-1/2 z-50 px-6 py-2 rounded-full shadow-lg text-white font-medium text-sm animate-slide-up flex items-center gap-2 ${colors[type] || colors.info}`}>
                    <span>{type === 'success' ? '‚úì' : type === 'error' ? '!' : 'i'}</span>
                    {message}
                </div>
            );
        };

        // 4. Level Badge (Dynamic Colors & PRO Animation)
        const LevelBadge = ({ level }) => {
            const lvl = parseInt(level);
            let colors = "bg-sky-400 text-white"; // 1-3
            let label = `LVL ${lvl}`;

            if (lvl >= 4 && lvl <= 6) {
                colors = "bg-yellow-500 text-black";
            } else if (lvl >= 7 && lvl < 10) {
                colors = "bg-red-600 text-white";
            } else if (lvl >= 10) {
                colors = "neon-pro text-white border-red-500";
                label = "PRO";
            }

            return (
                <span className={`${colors} px-3 py-1 rounded-full text-[10px] font-black tracking-tighter shadow-sm flex items-center justify-center min-w-[50px] uppercase`}>
                    {label}
                </span>
            );
        };

        // 5. Game Timer Component
        const GameTimer = ({ startTime }) => {
            const [timeLeft, setTimeLeft] = useState(30);
            const [afkTimeLeft, setAfkTimeLeft] = useState(25);
            
            useEffect(() => {
                const interval = setInterval(() => {
                    if (!startTime) return;
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    const remaining = Math.max(0, 30 - elapsed);
                    setTimeLeft(remaining);
                }, 100);
                return () => clearInterval(interval);
            }, [startTime]);

            return (
                <div className="absolute top-[15%] left-6 text-8xl font-black text-white/10 pointer-events-none select-none z-10">
                    {timeLeft}
                </div>
            );
        };

        // 6. Exit Game Button Component
        const ExitGameButton = ({ onExit, className = 'bottom-6 right-6 w-14 h-14' }) => {
            const [showConfirm, setShowConfirm] = useState(false);

            const handleExitClick = () => {
                setShowConfirm(true);
            };

            const handleConfirm = () => {
                onExit();
                setShowConfirm(false);
            };

            const handleCancel = () => {
                setShowConfirm(false);
            };

            const handleAFKTimeout = () => {
                if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {
                    wsRef.current.send(JSON.stringify({
                        type: 'afkTimeout',
                        playerId: playerId
                    }));
                }
            };

            // AFK Timer Effect
            useEffect(() => {
                if (gameState?.currentPlayer === playerId && screen === 'game') {
                    setAfkTimeLeft(25);
                    
                    afkTimerRef.current = setInterval(() => {
                        setAfkTimeLeft(prev => {
                            if (prev <= 1) {
                                clearInterval(afkTimerRef.current);
                                handleAFKTimeout();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }

                return () => {
                    if (afkTimerRef.current) {
                        clearInterval(afkTimerRef.current);
                    }
                };
            }, [gameState?.currentPlayer, playerId, screen]);

            // ...

            // --- OYUN MANTIƒûI ---
            const myPlayerId = gameState?.playerId;
            const isMyTurn = gameState?.currentPlayer === myPlayerId;
            const myHand = gameState?.players[myPlayerId]?.hand || [];
            const marketSize = gameState?.market?.length || 0;
            const canDrawFromMarket = marketSize > 0;
            
            // Rakibin elini al
            const opponentPlayerId = Object.keys(gameState?.players || {}).find(id => id !== myPlayerId);
            const opponentHand = gameState?.players[opponentPlayerId]?.hand || [];

            // ...

            // --- RENDER PARTS ---

            if (screen === 'game') return (
                <div className="fixed inset-0 flex flex-col bg-[#0b241c] overflow-hidden">
                    {notification && <Toast message={notification.message} type={notification.type} />}

                    {/* Timer */}
                    <GameTimer startTime={gameState.turnStartTime} />

                    {/* Sunucu Mesajƒ± Overlay (Oyun Kapalƒ± vb.) */}
                    {serverMessage && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-6">
                            <div className="bg-[#1b4d3e] border-2 border-yellow-500 rounded-2xl p-8 text-center shadow-2xl animate-bounce">
                                <div className="text-2xl font-bold text-white whitespace-pre-line leading-relaxed">
                                    {serverMessage.message}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Header - Rakip bilgisi a≈üaƒüƒ± kaydƒ±rƒ±ldƒ± */}
                    <div className="h-16 flex items-center justify-between px-6 bg-black/40 backdrop-blur-md z-30 mt-14">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full border-2 border-white/20 overflow-hidden">
                                {opponent?.photoUrl ? <img src={opponent.photoUrl} className="w-full h-full object-cover" /> : <div className="w-full h-full bg-slate-700 flex items-center justify-center">üë§</div>}
                            </div>
                            <div className="flex flex-col">
                                <div className="text-white font-bold text-sm leading-none">{opponent?.name || opponent?.username || 'Rakip'}</div>
                                <div className="mt-1 scale-75 origin-left">
                                    <LevelBadge level={opponent?.level || 1} />
                                </div>
                            </div>
                        </div>
                        
                        {/* Rakibin ta≈ü sayƒ±sƒ± */}
                        <div className="text-white text-sm font-bold">
                            {opponentHand.length} ta≈ü
                        </div>
                    </div>

                    {/* Rakibin ta≈ülarƒ± - isminin altƒ±nda */}
                    <div className="h-16 flex items-center justify-center bg-black/20 z-20">
                        <div className="opponent-hand">
                            {opponentHand.map((_, idx) => (
                                <DominoTile 
                                    key={idx} 
                                    values={[0, 0]} 
                                    isOpponent={true}
                                    disabled={true}
                                />
                            ))}
                        </div>
                    </div>

                    {/* Board Area */}
                    <div ref={boardContainerRef} className="flex-1 relative cursor-grab active:cursor-grabbing overflow-hidden">
                        <div
                            className="absolute transition-transform duration-500 ease-out"
                            style={{
                                transform: `translate(${boardOffset.x}px, ${boardOffset.y}px) scale(${boardScale})`,
                                transformOrigin: '0 0'
                            }}
                        >
                            {boardLayout.map((item, idx) => (
                                <div
                                    key={idx}
                                    className="absolute transition-all duration-500"
                                    style={{
                                        left: item.x,
                                        top: item.y,
                                        transform: `translate(-50%, -50%) rotate(${item.rotation}deg)`
                                    }}
                                >
                                    <DominoTile
                                        values={item.tile}
                                        vertical={false}
                                        disabled={true}
                                        scale={1}
                                    />
                                </div>
                            ))}

                            {/* Move Indicators */}
                            {isMyTurn && selectedTileIndex !== null && boardLayout.length > 0 && (
                                <>
                                    {validMoves.includes('left') && boardLayout[0] && (
                                        <div
                                            className="absolute w-20 h-10 border-4 border-yellow-400 border-dashed rounded-xl flex items-center justify-center animate-pulse cursor-pointer hover:bg-yellow-400/20 z-50 bg-black/40"
                                            onClick={() => playTile('left')}
                                            style={{
                                                left: boardLayout[0].x + (boardLayout[0].rotation === 90 ? 0 : (boardLayout[0].rotation === 180 ? 60 : -60)),
                                                top: boardLayout[0].y + (boardLayout[0].rotation === 90 ? -60 : 0),
                                                transform: 'translate(-50%, -50%)'
                                            }}
                                        >
                                            <span className="text-yellow-400 font-black text-[10px] drop-shadow-md">BURAYA</span>
                                        </div>
                                    )}
                                    {validMoves.includes('right') && boardLayout[boardLayout.length - 1] && (
                                        <div
                                            className="absolute w-20 h-10 border-4 border-yellow-400 border-dashed rounded-xl flex items-center justify-center animate-pulse cursor-pointer hover:bg-yellow-400/20 z-50 bg-black/40"
                                            onClick={() => playTile('right')}
                                            style={{
                                                left: boardLayout[boardLayout.length - 1].x + (boardLayout[boardLayout.length - 1].rotation === 90 ? 0 : (boardLayout[boardLayout.length - 1].rotation === 180 ? -60 : 60)),
                                                top: boardLayout[boardLayout.length - 1].y + (boardLayout[boardLayout.length - 1].rotation === 90 ? 60 : 0),
                                                transform: 'translate(-50%, -50%)'
                                            }}
                                        >
                                            <span className="text-yellow-400 font-black text-[10px] drop-shadow-md">BURAYA</span>
                                        </div>
                                    )}
                                </>
                            )}
                            {isMyTurn && selectedTileIndex !== null && boardLayout.length === 0 && validMoves.includes('start') && (
                                <div
                                    className="absolute w-32 h-16 border-4 border-yellow-400 border-dashed rounded-2xl flex items-center justify-center animate-bounce cursor-pointer bg-yellow-400/10 z-50"
                                    onClick={() => playTile('start')}
                                    style={{ left: 0, top: 0, transform: 'translate(-50%, -50%)' }}
                                >
                                    <span className="text-yellow-400 font-black">BA≈ûLA</span>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Oyundan √ßƒ±k butonu */}
                    <ExitGameButton onExit={leaveGameClient} className="top-4 right-4 w-10 h-10" />

                    {/* Controls Footer */}
                    <div className="h-48 z-30 bg-black/60 backdrop-blur-xl border-t border-white/10 p-4">
                        <div className="flex items-center justify-between mb-2">
                            <div className="text-white/50 text-xs font-bold uppercase tracking-widest">
                                {t.yourHand} ({myHand.length})
                                {isMyTurn && (
                                    <div className="text-yellow-400 text-xs font-medium mt-1">
                                        {afkTimeLeft}s qalƒ±b
                                    </div>
                                )}
                            </div>
                            {isMyTurn && (
                                marketSize > 0 ? (
                                    <button onClick={() => sendMessage({ type: 'drawFromMarket' })} className="bg-yellow-500 text-black px-4 py-1 rounded-full text-xs font-bold shadow-glow flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 01-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clipRule="evenodd" />
                                        </svg>
                                        {t.drawTile} ({marketSize})
                                    </button>
                                ) : (
                                    <button onClick={() => sendMessage({ type: 'passTurn' })} className="bg-red-600 hover:bg-red-500 text-white px-6 py-1 rounded-full text-xs font-bold shadow-glow animate-pulse flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clipRule="evenodd" />
                                        </svg>
                                        {t.passTurn}
                                    </button>
                                )
                            )}
                        </div>
                        
                        {/* Elindeki ta≈ülar - 8'den fazlaysa alt satƒ±ra ge√ß */}
                        <div className={`hand-container ${myHand.length > 8 ? '' : 'single-row'}`}>
                            {myHand.map((tile, idx) => (
                                <DominoTile
                                    key={idx}
                                    values={tile}
                                    onClick={() => handleTileClick(idx, tile)}
                                    isSelected={selectedTileIndex === idx}
                                    disabled={!isMyTurn}
                                />
                            ))}
                        </div>
                    </div>
                </div>
            );

            if (screen === 'end') return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-black/90 p-10 text-center">
                    <div className="text-8xl mb-6">
                        {endInfo.isAFK ? '‚è±Ô∏è' : (endInfo.isWinner ? 'üéâ' : 'üíÄ')}
                    </div>
                    {endInfo.isAFK && (
                        <div className="text-yellow-400 text-xl font-bold mb-4">
                            {endInfo.isWinner ? 'R…ôqib AFK olduƒüu √º√ß√ºn qalib g…ôldiniz!' : 'AFK olduƒüunuz √º√ß√ºn m…ôƒülub oldunuz!'}
                        </div>
                    )}
                    
                    {/* Kazanan */}
                    <div className="mb-8">
                        <div className="flex items-center justify-center gap-4 mb-4">
                            {endInfo.winnerPhoto ? (
                                <img src={endInfo.winnerPhoto} className="w-16 h-16 rounded-full border-4 border-yellow-500" />
                            ) : (
                                <div className="w-16 h-16 rounded-full border-4 border-yellow-500 bg-gray-700 flex items-center justify-center">üëë</div>
                            )}
                            <div className="text-left">
                                <h2 className="text-2xl font-bold text-white">{endInfo.winnerName}</h2>
                                <div className="text-green-400 text-xl font-black">{endInfo.isWinner ? t.winner : t.loser}</div>
                            </div>
                        </div>
                        <div className="text-3xl font-black text-green-400">
                            {endInfo.eloChange > 0 ? '+' : ''}{endInfo.eloChange} {t.eloChange}
                        </div>
                    </div>

                    {/* Kaybeden */}
                    <div className="mb-8">
                        <div className="flex items-center justify-center gap-4 mb-4">
                            {endInfo.loserPhoto ? (
                                <img src={endInfo.loserPhoto} className="w-16 h-16 rounded-full border-4 border-red-500" />
                            ) : (
                                <div className="w-16 h-16 rounded-full border-4 border-red-500 bg-gray-700 flex items-center justify-center">üòû</div>
                            )}
                            <div className="text-left">
                                <h2 className="text-2xl font-bold text-white">{endInfo.loserName}</h2>
                                <div className="text-red-400 text-xl font-black">{!endInfo.isWinner ? t.winner : t.loser}</div>
                            </div>
                        </div>
                        <div className="text-3xl font-black text-red-400">
                            {endInfo.eloChange > 0 ? '-' : '+'}{Math.abs(endInfo.eloChange)} {t.eloChange}
                        </div>
                    </div>

                    <div className="mt-12 text-white/30 animate-pulse">{t.returningLobby}</div>
                </div>
            );

            if (screen === 'searching') return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-[#0b241c]">
                    <div className="w-40 h-40 relative flex items-center justify-center">
                        <div className="absolute inset-0 border-8 border-red-500/20 rounded-full"></div>
                        <div className="absolute inset-0 border-8 border-t-red-500 rounded-full animate-spin"></div>
                        <div className="text-4xl animate-bounce">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-16 w-16 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                <path fillRule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clipRule="evenodd" />
                            </svg>
                        </div>
                    </div>
                    <h2 className="text-white text-3xl font-black mt-10">{t.searchingOpponent}</h2>
                    <p className="text-white/40 mt-2">{t.waitingOpponent}</p>
                    <button onClick={() => { sendMessage({ type: 'cancelSearch' }); setScreen('lobby'); }} className="mt-12 text-red-500 font-bold border border-red-500/30 px-6 py-2 rounded-full hover:bg-red-500/10 transition-all flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                        </svg>
                        {t.cancel}
                    </button>
                </div>
            );

            if (screen === 'leaderboard') return (
                <div className="flex flex-col items-center justify-start min-h-screen p-8 bg-[#0b241c] overflow-y-auto relative">
                    <button
                        onClick={() => setScreen('lobby')}
                        className="absolute top-6 left-6 w-12 h-12 flex items-center justify-center bg-white/10 rounded-2xl text-white text-2xl hover:bg-white/20 transition-all font-black"
                    >
                        ‚Üê
                    </button>
                    <h1 className="text-4xl font-black text-white mb-8">üìä LADERBOARD üìä</h1>
                    <div className="w-full max-w-xl space-y-3">
                        {leaderboard.map((p, i) => (
                            <div key={i} className="flex items-center gap-4 bg-white/5 p-4 rounded-3xl border border-white/5">
                                <div className="text-2xl font-black w-8 text-center">{i < 3 ? ['ü•á', 'ü•à', 'ü•â'][i] : i + 1}</div>
                                <img src={p.photoUrl || 'https://via.placeholder.com/50'} className="w-12 h-12 rounded-full" />
                                <div className="flex-1">
                                    <div className="text-white font-bold">{p.username}</div>
                                    <div className="flex items-center gap-2 mt-1">
                                        <LevelBadge level={p.level} />
                                        <div className="text-white/40 text-xs">{p.wins} Galibiyet</div>
                                    </div>
                                </div>
                                <div className="text-yellow-400 font-black">{p.elo} ELO</div>
                            </div>
                        ))}
                    </div>
                    <button onClick={() => setScreen('lobby')} className="mt-10 px-10 py-3 bg-white/10 text-white rounded-2xl font-bold">GERƒ∞ D√ñN</button>
                </div>
            );

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DominoGame />);
    </script>

    <script>
        const tgApp = window.Telegram.WebApp;
        tgApp.ready();
        tgApp.expand();
        if (tgApp.requestFullscreen) {
            tgApp.requestFullscreen();
        }
        tgApp.disableVerticalSwipes();
        tgApp.setHeaderColor('#1b4d3e');
    </script>

</body>
</html>
